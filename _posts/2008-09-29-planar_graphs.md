---
id: 164
title: "מים, חשמל וגז, והקשר שלהם לגרפים מישוריים"
date: 2008-09-29 10:43:05
layout: post
categories: 
  - משחקים וחידות מתמטיות
  - תורת הגרפים
social_media_share: true
---
די מפתיעה אותי כמות הנשמות התועות שמגיעות לבלוג הזה בחיפושים נואשים אחרי פתרון לחידת ה"מים, חשמל, גז". גיגול קצר הראה כי החידה המטופשת הזו אכן פופולרית למדי - אפילו יש <a href="http://www.flashy.co.il/games/online/SuPuzzle/806/">משחקי פלאש</a> עבורה. הנה תיאור קצר למי שאינו מכיר: ישנם שלושה בתים ושלושה מקורות שונים - מקור מים, מקור חשמל ומקור גז. רוצים להעביר קווים מכל אחד מהמקורות לכל אחד מהבתים (על דף דו ממדי) בלי שאף שני קווים יחתכו זה את זה. כיצד ניתן לעשות זאת?

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/gas-water-electricity1.png"><img class="alignnone size-full wp-image-366" title="gas-water-electricity" alt="" src="{{site.baseurl}}{{site.post_images}}/2008/09/gas-water-electricity1.png" width="319" height="248" /></a>

ובכן, התשובה הקצרה: <strong>לא ניתן</strong>. זו מהחידות האידיוטיות שאין להן פתרון, אבל מצליחות לשגע כמות לא מועטה של ילדים קטנים שמישהו עם נטיות סאדיסטיות מחליט להשתעשע איתם. זה לא הוגן, שכן למרות שהוכחה לכך שהחידה אינה פתירה איננה כה מסובכת, קשה לצפות מהאדם הממוצע לעלות עליה.

למעשה, אני לא מדייק - אם "מרמים" אפשר לפתור את החידה, כש"רמאות" פירושה להעביר קווים <strong>בתוך</strong> העיגולים של המים/חשמל/גז. מצד אחד פתרון כזה הוא דוגמה נאה לחשיבה מחוץ למסגרת, ומצד שני הוא פשוט דוגמה לכללים לא מוגדרים היטב. אם מניחים שאסור לחתוך את העיגולים (או שהעיגולים הם בעצם נקודות), החידה איננה פתירה.

עם זאת, למרות שבתור שעשוע אני פוסל את החידה הזו מכל וכל, מבחינה מתמטית יש לה ערך רב; למעשה, היא הבסיס לאפיון מלא של משפחה חשובה ומעניינת של גרפים - <a href="http://he.wikipedia.org/wiki/%D7%92%D7%A8%D7%A3_%D7%9E%D7%99%D7%A9%D7%95%D7%A8%D7%99">הגרפים המישוריים</a>.

נתחיל ב<a href="http://www.gadial.net/2008/05/06/eulerian_graphs/">תזכורת</a> קצרה. <a href="http://he.wikipedia.org/wiki/%D7%AA%D7%95%D7%A8%D7%AA_%D7%94%D7%92%D7%A8%D7%A4%D7%99%D7%9D">גרף מתמטי</a> (מהסוג שעליו אנחנו מדברים - לא זה שהוא שרטוט של פונקציה) הוא אוסף של <strong>צמתים</strong>, שמסומנים לרוב בנקודות או בעיגולים, ו<strong>קשתות</strong> שמחברות חלק מזוגות הצמתים. באופן כללי גרף לא צריך להיות מתואר באמצעות ציור; מספיק לתאר אותו באמצעות קבוצת הצמתים (שיכולה פשוט להיות קבוצה של מספרים: "צומת מס' 1", "צומת מס' 2" וכו') וקבוצת הקשתות ("צומת 3 מחובר לצומת 5"...). כל גרף ניתן לצייר בהמוני דרכים שונות על נייר, בפרט אם לא דורשים שהקשתות יהיו קווים ישרים; הנה דוגמה לאותו גרף כשאנו מציירים אותו בשתי דרכים שונות:

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/pg1.png"><img class="aligncenter size-full wp-image-3156" alt="pg1" src="{{site.baseurl}}{{site.post_images}}/2008/09/pg1.png" width="712" height="352" /></a>

מה שמעניין כאן הוא שבציור השמאלי, הקשתות של הגרף חותכות זו את זו (הקשת שמחברת את 2 עם 3 חותכת את הקשת שמחברת את 4 עם 1), אבל בציור הימני אף קשת לא חותכת אף קשת אחרת. מכאן אנו למדים שהתכונה "אם מציירים את הגרף על נייר, אין שתי קשתות שחותכות זו את זו" איננה טריוויאלית לחלוטין; יכולים להיות גרפים שהתיאור הרגיל שלהם על הנייר נראה מסובך ומלא חיתוכים פנימיים, אבל אפשר איכשהו לצייר אותם בלי שאף שתי קשתות יחתכו זו את זו. לגרף כזה, שניתן לצייר איכשהו על נייר דו ממדי ("מישור") מבלי שאף שתי קשתות יחתכו זו את זו קוראים "גרף מישורי" (Planar Graph).

כעת יש לנו ניסוח טוב יותר של חידת המים-חשמל-גז: האם הגרף הבא הוא מישורי?

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/pg2.png"><img class="aligncenter size-full wp-image-3157" alt="pg2" src="{{site.baseurl}}{{site.post_images}}/2008/09/pg2.png" width="505" height="348" /></a>

לגרף הזה יש שם: "הגרף הדו צדדי השלם עם 3 על 3 צמתים". גרף דו צדדי הוא גרף שניתן לחלק את צמתיו לשתי קבוצות (ללא איברים משותפים), כך שאין קשת בין אברי אותה קבוצה (ובמילים אחרות - קשת עוברת רק בין איבר מקבוצה א' לאיבר מקבוצה ב'). כאן אברי הקבוצה האחת מסומנים במספרים, ואברי הקבוצה האחרת - באותיות. בדוגמה המקורית קבוצה אחת הייתה קבוצת הבתים, והקבוצה השנייה הייתה קבוצת המקורות. פירוש המילה "שלם" כאן היא שכל קשת אפשרית (שתשאיר את הגרף דו-צדדי) קיימת בגרף - כל צומת מקבוצה א' מחובר לכל צומת מקבוצה ב'. ה"3 על 3 צמתים" פירושו שכל אחת משתי הקבוצות היא מגודל 3. את הגרף הדו צדדי הספציפי הזה מסמנים בתור {% equation %}K_{3,3}{% endequation %} (באופן כללי, {% equation %}K_{p,q}{% endequation %} פירושו גרף דו צדדי שלם על קבוצות מגודל {% equation %}p{% endequation %} ו-{% equation %}q{% endequation %}).

גרפים דו צדדיים הם מעניינים למדי בזכות תכונה מועילה מאוד שלהם: הם פשוטים מספיק כדי שניתן יהיה להוכיח עליהם טענות שיותר קשה (או אי אפשר) להוכיח על גרפים כלליים יותר, ולבנות <a href="http://en.wikipedia.org/wiki/Matching#Matchings_in_bipartite_graphs">אלגוריתמים שעבורם הם יעילים</a> ובגרפים כלליים יותר יהיו יעילים פחות (או לא יעילים בכלל); והם מסובכים מספיק כדי להופיע באופן טבעי בבעיות רבות. הדוגמה הטבעית שקופצת לראש היא הקצאת משאבים - חברי קבוצה אחת מייצגים עובדים שצריכים משאבים, וחברי הקבוצה השנייה מייצגים את המשאבים עצמם, והמטרה היא להקצות לכל עובד כמה שיותר משאבים שאף עובד אחר לא משתמש בהם. בלבוש אחר, זו "בעיית הנישואין" הידועה שבה צריך "להקצות" לכל אישה בעל (ונפתרת, במובן מסויים, באמצעות <a href="http://he.wikipedia.org/wiki/%D7%9E%D7%A9%D7%A4%D7%98_%D7%94%D7%97%D7%AA%D7%95%D7%A0%D7%94">משפט החתונה של הול</a>).

אם כן, הניסוח הסטנדרטי של המשפט המתמטי שהורג את חידת המים-חשמל-גז הוא "הגרף {% equation %}K_{3,3}{% endequation %} איננו מישורי". אביא כאן שתי הוכחות לטענה הזו; האחת ישירה למדי, וקרוב לודאי שכל ילד מסוגל להבין אותה. לרוע המזל, היא גם קרובה ככל שהדבר ניתן אל אותו שיקוץ שהמתמטיקאים מכנים "הוכחה באמצעות ציור"; הדרך היחידה לפרמל אותה בצורה שתשביע את רצונו של כל מתמטיקאי קפדן היא באמצעות שימוש במשפט כבד למדי - <a href="http://en.wikipedia.org/wiki/Jordan_curve_theorem">משפט עקומת ז'ורדן</a>. משפט ז'ורדן אומר דבר מה שנראה טריוויאלי לחלוטין - שכל עקומה (לצורך העניין עקומה היא מה שמקבלים כששמים עיפרון על דף ומציירים בלי להרים את העיפרון מהדף) שלא חותכת את עצמה ושני קצותיה מתלכדים מחלקת את העולם (הדף שעליו ציירנו) ל"פנים" ו"חוץ", ולא ניתן להגיע מהאחד לשני בלי לחתוך את העקומה בדרך. למרות שהמשפט נשמע טריוויאלי, הוכחתו מסובכת למדי. מצד אחד, זה נשמע אבסורדי. מצד שני, חשוב להבין שהמושג המדוייק של עקומה מוגדר בצורה יותר מורכבת ממה שהצגתי כאן (מה שהצגתי כאן לא ראוי להיקרא "הגדרה"), ולפורמליזם ולדיוק הזה יש מחיר.

הרעיון הבסיסי הוא זה: נסתכל על המעגל שנוצר מחיבור הקשתות 1-א'-2-ב'-3-ג'-1 (הקשת מ-1 אל א'; הקשת מא' אל 2, וכו'). זה לא מעגל במובן הרגיל מגאומטריה, אלא פשוט מסלול בגרף שמתחיל ומסתיים באותו מקום. בכל צורה שבה נצייר את הגרף במישור, אוסף כל הקשתות הללו יתחום איזור כלשהו ויחלק אותו ל"פנים" ו"חוץ". גם את זה כדאי להמחיש עם ציור:

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/pg3.png"><img class="aligncenter size-full wp-image-3158" alt="pg3" src="{{site.baseurl}}{{site.post_images}}/2008/09/pg3.png" width="576" height="380" /></a>

נניח לרגע שהקשת שעוברת בין 1 לב' עוברת בתוך ה"פנים" של המעגל; כפי שנראה בהמשך, ההנחה הזו לא פוגעת בהוכחה. אחרי שנעביר את הקשת נקבל את הדבר הבא:

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/pg4.png"><img class="aligncenter size-full wp-image-3154" alt="pg4" src="{{site.baseurl}}{{site.post_images}}/2008/09/pg4.png" width="597" height="432" /></a>

מה קורה כעת עם הקשת א'-3? היא חייבת להימתח מחוץ לפנים המעגל; כי אם היא נמתחת בפנים, היא בהכרח תחתוך את הקשת 1-ב'. זה ברור מהציור, אבל גם פורמלית ניתן להראות זאת, בהסתמך על כך שהמעגל 1-ב'-3-ג'-1 מחלק את העולם ל"פנים" ו"חוץ" בעצמו, והנקודה א' נמצאת ב"חוץ", כך שקו שנמצא ב"פנים" ומגיע אל א' חייב לעבור דרך קשתות המעגל בשלב מסויים.

אם כן, נמתח את הקשת בחוץ ונקבל משהו שכזה:

<a href="{{site.baseurl}}{{site.post_images}}/2008/09/pg5.png"><img class="aligncenter size-full wp-image-3155" alt="pg5" src="{{site.baseurl}}{{site.post_images}}/2008/09/pg5.png" width="597" height="466" /></a>

אבל כעת לא ניתן למתוח קו מ-2 אל ג', מאותם נימוקים. אם מלכתחילה היינו מציירים את 1-ב' בחוץ היינו "כולאים" צומת כלשהי בצורה דומה לכך שצומת מס' 2 נכלאה, ולכן גם אז היינו מגיעים לסתירה.

אם כן, זו ההוכחה. לרוע המזל, היא אינה יפה כלל ועיקר, ופחות או יותר אומרת "בואו נבדוק את כל המקרים האפשריים". למרבה המזל, יש הוכחה קצרה ואלגנטית בהרבה, שמסתמכת על משפט בסיסי ויפה הנוגע לגרפים מישוריים - <a href="http://he.wikipedia.org/wiki/%D7%A0%D7%95%D7%A1%D7%97%D7%AA_%D7%90%D7%95%D7%99%D7%9C%D7%A8_(%D7%AA%D7%95%D7%A8%D7%AA_%D7%94%D7%92%D7%A8%D7%A4%D7%99%D7%9D)">נוסחת אוילר</a>.

כדי להבין את נוסחת אוילר, צריך להכניס לשימוש מושג נוסף שטרם דיברתי עליו - פאות (Face) של גרף מישורי. פאה היא פשוט אחד מהתאים שמוגדרים על ידי הגרף; ניתן לחשוב על פאה מסויימת כעל אוסף כל הנקודות שניתן להגיע מכל אחת מהן לאחרת מבלי לחצות אף קשת של הגרף (פורמלית - רכיב קשירות של מה שנותר מהמישור אחרי שמסלקים ממנו את כל הנקודות שהיו על קשתות הגרף). כך למשל לגרף שהוא מעגל פשוט יש שתי פאות - כל מה שבתוך המעגל, וכל מה שבחוץ (שמהווה מעין פאה אינסופית). גרף שאין בו אף מעגל מכיל רק פאה אחת, וכדומה. בגרף שבציור האחרון שלמעלה יש ארבע פאות, למשל.

שאלה מעניינת היא האם מספר הפאות של גרף נובעות מאופן הציור שלו, או שלא משנה איך נצייר אותו, תמיד נקבל אותו מספר פאות (כך שמספר הפאות הוא שמורה (invariant) של הגרף). התשובה היפה יותר, מבחינה מתמטית, היא השנייה; ואכן, מסתבר שכך הדבר, אבל טוב מכך - יש קשר פשוט להדהים בין מספר הפאות של הגרף ובין מספר הצמתים והקשתות שלו. אם הגרף קשיר (כלומר, יש מסלול מכל צומת לכל צומת אחר), בעל {% equation %}n{% endequation %} צמתים, {% equation %}m{% endequation %} קשתות ו-{% equation %}f{% endequation %} פאות, אז מתקיים {% equation %}n-m+f=2{% endequation %}. ההוכחה היא אינדוקטיבית על מספר הפאות, ואינה מסובכת במיוחד; אם יש רק פאה אחת, אז בהכרח הגרף הוא עץ, דהיינו גרף קשיר וחסר מעגלים (כי אחרת היה בו מעגל, ועל פי משפט ז'ורדן זה היה גורר שתי פאות), וידוע שבעץ מתקיים {% equation %}m=n-1{% endequation %}; וכאשר יש לנו {% equation %}f+1{% endequation %} פאות אפשר לבחור קשת שנמצאת על מעגל, להסיר אותה, לקבל פאה אחת פחות (כי איחדנו שתי פאות) וקשת אחת פחות וגרף שעודנו קשיר, כך שניתן להשתמש עליו בהנחת האינדוקציה. ההכללה של הנוסחה לגרפים שאינם קשירים אינה מסובכת; חשבו על כך שכל גרף ניתן להציג כאיחוד זר של גרפים קשירים.

נוסחת אוילר מובאת כאן כמעט כקוריוז, לצורך הוכחה נוספת של משהו שכבר הוכחנו. ראוי להבהיר שיש לה חשיבות רבה הן מבחינה תיאורטית, והן מבחינה מעשית -  כאשר עוסקים ב<a href="http://en.wikipedia.org/wiki/Computational_geometry">גאומטריה חישובית</a>, היא מועילה לעתים קרובות במדידת סיבוכיות של אלגוריתמים.

חזרה לגרף {% equation %}K_{3,3}{% endequation %} האומלל. מכיוון שיש בו (קל לספור) {% equation %}n=6{% endequation %} צמתים ו-{% equation %}m=9{% endequation %} קשתות, נוסחת אוילר מראה לנו מייד ש<strong>אם</strong> הוא מישורי, אז בכל ציור שלו במישור יהיו לו {% equation %}f=2+m-n=5{% endequation %} פאות. כעת נשים לב כי ניתן לספור את {% equation %}m{% endequation %} באמצעות הפאות. אם {% equation %}p{% endequation %} היא פאה כלשהי של הגרף, ו-{% equation %}d(p){% endequation %} הוא מספר הקשתות שנמצאות בפאה הזו (בתוכה או על השפה שלה), אז נקבל ש-{% equation %}m\ge\frac{1}{2}\sum d(p){% endequation %} כשהסכום נלקח על כל הפאות של הגרף; זאת מכיוון שאנו סופרים כל קשת לכל היותר פעמיים כי היא שייכת לכל היותר לשתי פאות (יש קשתות שנמצאות כולן בפאה אחת; לפעמים מסכימים לספור אותן פעמיים כדי שיתקבל שוויון מלא בנוסחה, אך אין לנו צורך בכך כאן).

כעת לפואנטה. בגרף שמכיל יותר מפאה אחת, כל פאה נקבעת באמצעות מעגל שיוצרות הקשתות שעל שפתה; אבל בגרף הדו צדדי, האורך המינימלי של מעגל הוא 4 (בדרך כלל הוא 3, אבל כאן זה בלתי אפשרי - מדוע?) ולכן {% equation %}d(p)\ge 4{% endequation %}. לכן נקבל:

{% equation %}9=m\ge\frac{1}{2}\sum d(p)\ge\frac{1}{2}\cdot f\cdot 4=2f=10{% endequation %}

והגענו לסתירה, כי 9 אינו גדול מ-10. פשוט ואלגנטי (אם כי, כמקודם, צופן בחובו את משפט ז'ורדן, אך זה כנראה בלתי נמנע כי עצם הגדרתו הפורמלית המדוייקת של גרף מישורי דורשת שנערב את ז'ורדן בעסק, כדי שאפשר יהיה להגדיר במדוייק חיתוכים בין קשתות).

הבטחתי שיש לחידת המים-חשמל-גז חשיבות רבה במתמטיקה, הרבה מעבר למה שנדמה; כעת אסביר מדוע. ראשית, אציג עוד גרף חביב ומוכר: {% equation %}K_5{% endequation %}, "הגרף השלם על 5 צמתים". ההבדל המהותי בין גרף זה לגרף {% equation %}K_{3,3}{% endequation %} הוא ש-{% equation %}K_5{% endequation %} אינו דו צדדי; כל אחד מחמשת צמתיו מחובר לארבעת הצמתים האחרים. זה נראה ככה:

<img alt="" src="http://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Complete_graph_K5.svg/100px-Complete_graph_K5.svg.png" />

הציור הזה עשוי לעורר קונוטציות של עובדי שטן, וחבל; מבחינה מתמטית הוא יפהפה. שימו לב כיצד הוא בנוי: מחומש משוכלל (שכל צלעותיו מאותו האורך), שבתוכו כוכב מושלם, שבתוכו עוד מחומש משוכלל, רק קטן יותר, וכן הלאה וכן הלאה.

מה שמעניין ב-{% equation %}K_5{% endequation %} זה שהוא הגרף השלם הקטן ביותר שאינו מישורי; כבר ראינו בפוסט זה עצמו ש-{% equation %}K_4{% endequation %} הוא מישורי (חזרו לציור שבתחילת הפוסט). ההוכחה ש-{% equation %}K_5{% endequation %} אינו מישורי דומה באופיה להוכחה ש-{% equation %}K_{3,3}{% endequation %} אינו מישורי, אך מסובכת מעט יותר ולא אביא אותה כאן. הסיבה לכך שטורחים להוכיח את אי המישוריות של שני הגרפים הללו דווקא היא שמתברר כי די בכך כדי לאפיין את כל הגרפים שאינם מישוריים: כל גרף שאינו מישורי יכיל, בצורה מסויימת, אחד משני הגרפים הללו - או את {% equation %}K_{3,3}{% endequation %} או את {% equation %}K_5{% endequation %}.

צריך קצת להיזהר בכל הנוגע ל"צורה מסויימת" - בפירוש אין הכוונה לכך שכל גרף לא מישורי יכיל אחד משני הגרפים הללו כתת-גרף (כלומר, מה שנשאר אחרי שמוחקים חלק מהצמתים ואת הקשתות שנגעו באותם צמתים). ישנם שני משפטים שונים, הראשון של ווגנר והשני של קורטובסקי, שנותנים שני אפיונים שונים של גרפים מישוריים המשתמשים ב {% equation %}K_{3,3}{% endequation %} ו-{% equation %}K_5{% endequation %}.

ווגנר מדבר על מה שנקבל מהגרף שאנו בודקים באמצעות סדרה של כיווצים (Contractions), כש"כיווץ" הוא פעולה שבה לוקחים קשת כלשהי ומאחדים את שני הצמתים שבקצותיה לצומת בודד, שמחובר לכל מי ששני הצמתים המקוריים חוברו אליו. פרט לכך ווגנר מתיר גם מחיקת קשתות, וסילוק מהגרף של צמתים שאף קשת לא מחוברת אליהם. אם ניתן באמצעות שלוש הפעולות הללו להגיע אל  {% equation %}K_{3,3}{% endequation %} או אל {% equation %}K_5{% endequation %}, אז על פי ווגנר הגרף אינו מישורי; ואחרת הוא כן. למעשה, התוצאה הזו היא רק בסיס לתיאוריה כללית יותר העוסקת בגרפים ובהגדרה שלהם באמצעות "מינורים אסורים" (מינור של גרף הוא כל גרף שניתן לקבל ממנו על ידי הפעולות שלעיל), ויש לה שימושים אפילו בלוגיקה; אך לא אכנס לזה כעת.

האפיון השני, של קורטובסקי, עוסק בפעולה "הפוכה" לכאורה, של הרחבה. בהינתן גרף, אפשר לקחת קשתות ולתקוע להן צמתים "באמצע" (כלומר, להוסיף צמתים שמחוברים אך ורק לשני הצמתים שבמקור היו קצות הקשת הזו). הגרף שמתקבל נקרא "תת-חלוקה" (Subdivision) של הגרף המקורי. קורטובסקי אומר שגרף איננו מישורי אם ורק אם יש לו תת גרף שהוא חלוקה של אחד משני הגרפים {% equation %}K_{3,3}{% endequation %} או אל {% equation %}K_5{% endequation %}.

ויקיפדיה האנגלית מביאה דוגמה נאה להמחשת שני המשפטים:

<img alt="" src="http://upload.wikimedia.org/wikipedia/en/1/10/Nonplanar_no_subgraph_K_3_3.JPG" width="176" height="173" />

הגרף הזה נראה "כמעט" כמו {% equation %}K_{3,3}{% endequation %}, אבל הוא אינו מכיל כתת גרף לא את {% equation %}K_{3,3}{% endequation %} ולא את {% equation %}K_5{% endequation %}. מצד שני, הוא די בבירור התקבל מ-{% equation %}K_{3,3}{% endequation %} על ידי הוספת הצומת B באמצע הקשת CF, כלומר הוא חלוקה של {% equation %}K_{3,3}{% endequation %} ולכן על פי קורטובסקי הוא אינו מישורי; ואם נכווץ את הגרף על ידי כך שנאחד את B עם C (או את B עם F) נקבל את {% equation %}K_{3,3}{% endequation %} ולכן על פי ווגנר הוא אינו מישורי.

אם כן, חידת המים-חשמל-גז היא דווקא נושא מתמטי מעניין מאוד; אבל לתת אותה כחידה לילדים, מבלי לגלות אחרי זמן קצר את הפתרון, זו סתם רשעות.
