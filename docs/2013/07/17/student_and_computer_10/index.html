<!DOCTYPE html>
<html lang="he" dir="rtl"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>פרוייקט “התלמיד והמחשב”, בעיה 10 | לא מדויק</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="פרוייקט “התלמיד והמחשב”, בעיה 10" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="לא מדויק - בלוג על מתמטיקה ומדעי המחשב" />
<meta property="og:description" content="לא מדויק - בלוג על מתמטיקה ומדעי המחשב" />
<link rel="canonical" href="http://gadial.net/2013/07/17/student_and_computer_10/" />
<meta property="og:url" content="http://gadial.net/2013/07/17/student_and_computer_10/" />
<meta property="og:site_name" content="לא מדויק" />
<meta property="og:image" content="http://gadial.net/assets/img/main/default-card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-07-17T21:00:05+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="http://gadial.net/assets/img/main/default-card.png" />
<meta property="twitter:title" content="פרוייקט “התלמיד והמחשב”, בעיה 10" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://gadial.net/2013/07/17/student_and_computer_10/","image":"http://gadial.net/assets/img/main/default-card.png","headline":"פרוייקט “התלמיד והמחשב”, בעיה 10","dateModified":"2013-07-17T21:00:05+00:00","datePublished":"2013-07-17T21:00:05+00:00","description":"לא מדויק - בלוג על מתמטיקה ומדעי המחשב","mainEntityOfPage":{"@type":"WebPage","@id":"http://gadial.net/2013/07/17/student_and_computer_10/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link href="/assets/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon"><link type="application/atom+xml" rel="alternate" href="http://gadial.net/feed.xml" title="לא מדויק" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3924539-2', 'auto');
  ga('send', 'pageview');
}
</script>
  
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        processEscapes: true
      },
      TeX: {extensions: ["AMSmath.js","AMSsymbols.js"]},
      "HTML-CSS": { 
        linebreaks: { automatic: true }
      },
      SVG: { 
        linebreaks: { automatic: true } 
      }
    });
  </script>
  <!-- "https://www.gadial.net/wp-includes/js/xypic.js" -->

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  
</head>
<body><header>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="/">לא מדויק</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        
            
            <li class="nav-item">
                <a class="nav-link" href="/lecture_notes">סיכומי הרצאות</a>
            </li>
            
        
            
            <li class="nav-item">
                <a class="nav-link" href="/">דף הבית</a>
            </li>
            
        
            
            <li class="nav-item">
                <a class="nav-link" href="/categories">קטגוריות</a>
            </li>
            
        
            
            <li class="nav-item">
                <a class="nav-link" href="/random">דף אקראי</a>
            </li>
            
        
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">אודות</a>
            </li>
            
        
      </ul>
      <form class="form-inline mt-2 mt-md-0" action="/post_list/" method="get">
        <input class="form-control mr-sm-2" type="text" placeholder="חיפוש" aria-label="חיפוש" name="s">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">חיפוש</button>
      </form>
    </div>
  </nav>
</header><main class="page-content" aria-label="Content" role="main">
      <div class="wrapper text-right">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><div class="PageNavigation">
    
      <a class="prev" href="/2013/07/14/student_and_computer_9/">&laquo; פרוייקט "התלמיד והמחשב", בעיה 9</a>
    
    
      <a class="next" href="/2013/07/21/complex_analysis_intro/">אז מה זו אנליזה מרוכבת? &raquo;</a>
    
  </div><header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">פרוייקט &quot;התלמיד והמחשב&quot;, בעיה 10</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-07-17T21:00:05+00:00" itemprop="datePublished">Jul 17, 2013
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>גם הפעם יש לנו בעיה פשוטה ביותר שאני מנצל כדי להראות כמה להטוטי תכנות כלליים, אבל הפעם הבעיה חמורה יותר מבדרך כלל - אני צריך לבחור בין הפתרון הנכון יותר מתמטית והיעיל יותר ובין הפתרון הטיפשי. ואני בוחר בפתרון הטיפשי אחרת הכל יהיה קצר מדי.</p>

<p>הבעיה היא לקבל כקלט פרמטרים שמגדירים סדרה חשבונית או הנדסית, ולהוציא את סכום הסדרה כפלט. בואו נזכיר מה אלו הסדרות הללו. בשני המקרים מדובר על סדרות של מספרים (ואני מניח בפתרונות שלי שאלו אפילו מספרים שלמים) מאורך סופי כלשהו שמסומן ב-<span>\( n \)</span>. את הסדרה עצמה אפשר לסמן, למשל, כך: <span>\( a_0, a_1, a_2, \dots, a_{n-1} \)</span>. שימו לב שאני מתחיל את מספור האיברים מ-0 ולכן האינדקס של האיבר האחרון הוא <span>\( n-1 \)</span>. לסדרה <strong>חשבונית</strong> יש את התכונה המיוחדת שההפרש בין כל שני איברים סמוכים בה הוא מספר קבוע שמסומן ב-<span>\( d \)</span>; לסדרה <strong>הנדסית</strong> יש את התכונה שהמנה של כל שני איברים סמוכים בה היא מספר קבוע שמסומן ב-<span>\( q \)</span>. שלושת הפרמטרים של מספר האיברים בסדרה, האיבר הראשון בה וההפרש/מנה הקבוע מאפיינים באופן מוחלט את הסדרה: מאוד קל לראות שהאיבר מספר <span>\( i \)</span> בסדרה חשבונית הוא <span>\( a_0+id \)</span> והאיבר מספר <span>\( i \)</span> בסדרה הנדסית הוא <span>\( a_0q^{i} \)</span>.</p>

<p>עכשיו, מה שמבקשים מאיתנו למצוא הוא את <strong>סכום</strong> האיברים בסדרה, כלומר את <span>\( a_0+a_1+\dots+a_{n-1} \)</span>. בעולם האמיתי יש נוסחאות פשוטות שמחזירות את הסכום הזה: <span>\( n\left(a_0+\frac{d(n-1)}{2}\right) \)</span> עבור סדרה חשבונית ו-<span>\( a_0\frac{q^n-1}{q-1} \)</span> עבור סדרה הנדסית. לא קשה להוכיח שהנוסחאות הללו עובדות אבל לא אעשה את זה כרגע כי זה פוסט על תכנות ולא על טורים; הנקודה היא שאני בכלל לא הולך להשתמש בנוסחאות הללו. אני רוצה לחשב את הסכומים בדרך הקשה - לחשב איבר-איבר, ולקחת את הסכום שלהם.</p>

<p>אבל גם גישה נאיבית שכזו אפשר לבצע בדרכים שונות, ואני אנצל את קוד הרובי שלי כדי להציג את שתי הדרכים העיקריות - דרך אחת, הישירה והנאיבית יותר, תשמש לחישוב סכום הסדרה אם היא סדרה חשבונית; והדרך השניה, שיותר מתאימה לאופי של רובי, תשמש לחישוב סכום הסדרה אם היא סדרה הנדסית. האופן שבו בוחרים באיזו דרך פעולה לנקוט יהיה באמצעות עוד כלי נפוץ בשפות, שהוא מעין משפט if מחוכם - משפט case, שגם אותו אסביר. הנה הקוד:</p>

<div class="code-block">

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">case</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">when</span> <span class="s2">"A"</span>
  <span class="n">a0</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">to_i</span><span class="p">,</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">to_i</span><span class="p">,</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">to_i</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">a0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">d</span>
  <span class="k">end</span>
<span class="k">when</span> <span class="s2">"G"</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">to_i</span><span class="p">,</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">to_i</span><span class="p">,</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">to_i</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">n</span><span class="p">).</span><span class="nf">collect</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">a0</span><span class="o">*</span><span class="n">q</span><span class="o">**</span><span class="n">i</span><span class="p">}.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">){</span><span class="o">|</span><span class="n">temp_sum</span><span class="p">,</span> <span class="n">x</span><span class="o">|</span> <span class="n">temp_sum</span> <span class="o">+</span> <span class="n">x</span><span class="p">}</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"The sum is </span><span class="si">#{</span><span class="n">sum</span><span class="si">}</span><span class="s2">"</span></code></pre></figure>

</div>

<p>נתחיל מלהבין את ה-case. התחביר של משפט case הוא כזה: קודם כל כותבים case ואז שם של משתנה כלשהו, ואז נפתח אוטומטית בלוק (כלומר, צריך לכתוב end כדי לציין את המקום שבו העסק עם ה-case נגמר). בתוך הבלוק יש משפטים מהצורה when כשאחרי ה-when יש ערך כלשהו. מה שקורה בתוכנית הוא שמשווים את המשתנה שהופיע אחרי ה-case לערך הזה, ואם הם שווים, מבצעים את כל מה שנכתב אחרי ה-when ועד ל-when הבא (אם רוצים לכתוב באותה שורה את ה-when ואת מה שצריך לבצע אחריו צריך לכתוב then כדי להגיד לרובי איפה הערך שאליו צריך להשוות נגמר והקוד שצריך לבצע מתחיל).</p>

<p>כשאני אומר שהבדיקה היא האם הערך של המשתנה <strong>שווה</strong> לערך של מה שמופיע אחרי ה-when אני משקר בצורה גסה וגורם למשפטי case להיות הרבה פחות מגניבים ממה שהם. בפועל רובי לא משתמשת באופרטור ההשוואה הרגיל כדי לבצע את ההשוואה אלא באופרטור מיוחד, שמסומן בתור ===, כדי לבצע את ההשוואה, וזה אומר שאפשר לעשות יותר מאשר להשוות שני ערכים: אפשר אחרי ה-when לכתוב <strong>טווח</strong> של ערכים או <strong>סדרה</strong> של ערכים והתנאי יתקיים אם הערך שמכיל המשתנה משתייך אליהם; אפשר לכתוב <strong>ביטוי רגולרי</strong> והתנאי יתקיים אם המחרוזת שהמשתנה מכיל מתאימה לו; אפשר לכתוב <strong>מחלקה</strong> והתנאי יתקיים אם המשתנה הוא אובייקט ששייך למחלקה הזו… בקיצור, דברים מגניבים למדי (שייתכן מאוד שנשמעו לכם כרגע כמו ג’יבריש, וזה למה אני לא נכנס אליהם). ברובי משפטי case הם דברים מעולים ואני מאוד מחבב אותם. בשפות כמו C הם קצת יותר מושמצים ונדבר על זה כשנגיע לג’אווהסקריפט.</p>

<p>חישוב הסכום כשהסדרה היא חשבונית (מזהים את זה על ידי כך שהפרמטר הראשון שהתוכנית קיבלה היה “A”) הוא בנאלי ולא ארחיב עליו (נסו לראות שאתם מבינים מה אני עושה שם!). מה שמעניין הוא חישוב הסכום כשהסדרה היא הנדסית, שנעשה כולו בשורה ארוכה אחת:</p>

<div class="code-block">

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">n</span><span class="p">).</span><span class="nf">collect</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">a0</span><span class="o">*</span><span class="n">q</span><span class="o">**</span><span class="n">i</span><span class="p">}.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">){</span><span class="o">|</span><span class="n">temp_sum</span><span class="p">,</span> <span class="n">x</span><span class="o">|</span> <span class="n">temp_sum</span> <span class="o">+</span> <span class="n">x</span><span class="p">}</span></code></pre></figure>

</div>

<p>מה שקורה כאן הוא דבר די נפוץ ברובי. אנחנו מתחילים מאובייקט שהוא אוסף של מספרים - במקרה הזה, כל המספרים בין 0 ל-9, שמיוצגים על ידי אובייקט של <strong>טווח</strong>, ואז מתחילים לעשות על האובייקט הזה סדרה של פעולות. הפעולה הראשונה היא collect שמחליפה כל מספר בטווח באיבר המתאים בסדרה ההנדסית. קיבלנו מערך שכולל את כל האיברים בסדרה ההנדסית, ונותר לסכום אותו. לצורך כך אנחנו מגייסים את המתודה inject שפועלת כך: בנוסף למערך שקורא לה היא מקבלת כקלט גם פרמטר נוסף, שבמקרה הזה הוא 0, שהוא “הערך ההתחלתי”, ובלוק. בתוך הבלוק ישנם שני משתנים, שאני קורא להם temp_sum ו-x. הרעיון הוא כזה: ראשית inject מאתחלת את temp_sum להיות הערך שהועבר לה - 0 במקרה שלנו. כעת היא עוברת סדרתית על כל אברי המערך, מציבה כל אחד מהם בתוך x, מריצה את הבלוק ומציבה בתוך temp_sum את תוצאת הבלוק, שהיא במקרה הנוכחי הערך temp_sum+x. כל זה מתורגם לסכימה של איברי המערך ולכן להחזרה של התוצאה הנכונה.</p>

<p>אפשר לתהות למה כל כאב הראש הזה ולמה אין פשוט פונקציה שנקראת sum (בפייתון, למשל, יש) - התשובה היא ש-inject הוא משהו הרבה יותר כללי וחזק, ומי שרוצה שיהיה לו sum יכול לממש בקלות את הפונקציה הזו בצד (אסביר בעתיד איך).</p>

<p>בואו נעבור לראות איך עושים דבר דומה בהסקל. הרעיון הכללי זהה, אבל הפרטים קצת שונים:</p>

<div class="code-block">

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">System.Environment</span>

<span class="n">arithmetic_series_sum</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">))</span>
<span class="n">arithmetic_series_sum</span> <span class="n">a0</span> <span class="n">d</span> <span class="n">n</span> <span class="o">=</span> <span class="n">foldl</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="mi">0</span> <span class="p">[</span><span class="n">a0</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="n">i</span> <span class="o">|</span> <span class="n">i</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">geometric_series_sum</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">))</span>
<span class="n">geometric_series_sum</span> <span class="n">a0</span> <span class="n">q</span> <span class="n">n</span> <span class="o">=</span> <span class="n">foldl</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="mi">0</span> <span class="p">[</span><span class="n">a0</span> <span class="o">*</span> <span class="n">q</span><span class="o">^</span><span class="n">i</span> <span class="o">|</span> <span class="n">i</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">series_sum</span> <span class="o">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="n">series_sum</span> <span class="p">(</span><span class="s">"A"</span><span class="o">:</span><span class="n">a0</span><span class="o">:</span><span class="n">d</span><span class="o">:</span><span class="n">n</span><span class="o">:</span><span class="kt">[]</span><span class="p">)</span> <span class="o">=</span> <span class="n">arithmetic_series_sum</span> <span class="p">(</span><span class="n">read</span> <span class="n">a0</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">d</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">n</span><span class="p">)</span>
<span class="n">series_sum</span> <span class="p">(</span><span class="s">"G"</span><span class="o">:</span><span class="n">a0</span><span class="o">:</span><span class="n">q</span><span class="o">:</span><span class="n">n</span><span class="o">:</span><span class="kt">[]</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometric_series_sum</span> <span class="p">(</span><span class="n">read</span> <span class="n">a0</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">q</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">n</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="n">args</span> <span class="o">&lt;-</span> <span class="n">getArgs</span>
  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">show</span><span class="p">(</span><span class="n">series_sum</span> <span class="n">args</span><span class="p">))</span></code></pre></figure>

</div>

<p>כל החלק עם ה-series_sum לקראת הסוף בא במקום ה-case של רובי. שימו לב לשימוש שלי ב<strong>תבניות</strong> של הקלט ש-series_sum מצפה לקבל, ואיך הוא מאפשר לי לתת שמות שונים למשתנים (d אל מול q). אבל זה משהו שכבר ראינו בפוסטים קודמים - החידוש מגיע במימושים של פונקציות הסכום. בשתיהן אני משתמש ב-list comprehension כדי ליצור את רשימת כל איברי הסדרה; וכדי לחשב את הסכום אני מפעיל פונקציה שנקראת foldl ומקבלת שלושה פרמטרים: הראשון הוא האופרטור +, השני הוא הערך 0 והשלישי הוא המערך. כפי שניתן לנחש, foldl עוברת סדרתית על אברי המערך ומפעילה את האופרטור + בכל פעם על ערך זמני שיש לה (שאותחל להיות 0 על פי הפרמטר שהעברתי) והאיבר הבא בתור מהמערך. הנה איך אפשר לממש את הפונקציה הזו:</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="kt">[]</span>     <span class="o">=</span> <span class="n">z</span>
<span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="n">xs</span><span class="p">)</span> <span class="o">=</span> <span class="kr">let</span> <span class="n">z'</span> <span class="o">=</span> <span class="n">z</span> <span class="p">`</span><span class="n">f</span><span class="p">`</span> <span class="n">x</span>
                   <span class="kr">in</span> <span class="n">foldl</span> <span class="n">f</span> <span class="n">z'</span> <span class="n">xs</span></code></pre></figure>

<p>&lt;/div&gt;</p>

<p>אבל אין צורך לכתוב את המימוש במפורש - הוא כאן רק כדי לעזור לכם להבין את הפונקציה, ובפועל foldl היא חלק סטנדרטי מהשפה. יש גם פונקציה foldr (ה-l,r בסוף הם מלשון left, right) אבל זו פונקציה בעייתית יותר ולא אכנס לדקויות הללו כרגע.</p>

<p>בואו נעבור למימוש בג’אווהסקריפט שבו אין שום דבר מחוכם מבחינת חישוב הסכומים, אבל הוא כן מציג עוד משהו מבחינת הדברים שג’אווהסקריפט יכולה לעשות בדפדפן:</p>

<div class="code-block">

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Targil 10<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">var</span> <span class="nx">arithmeticSeriesSum</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a0</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">n</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
		<span class="nx">sum</span> <span class="o">=</span> <span class="nx">sum</span> <span class="o">+</span> <span class="p">(</span><span class="nx">a0</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">d</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">geometricSeriesSum</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a0</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">n</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
		<span class="nx">sum</span> <span class="o">=</span> <span class="nx">sum</span> <span class="o">+</span> <span class="p">(</span><span class="nx">a0</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span><span class="nx">i</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">computeSum</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">a0</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">a0</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">d_or_q</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">d_or_q</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">n</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">switch</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span>
		<span class="k">case</span> <span class="dl">"</span><span class="s2">A</span><span class="dl">"</span><span class="p">:</span>
		  <span class="nx">result</span> <span class="o">=</span> <span class="nx">arithmeticSeriesSum</span><span class="p">(</span><span class="nx">a0</span><span class="p">,</span> <span class="nx">d_or_q</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
		  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">d_or_q_label</span><span class="dl">"</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">;</span>
		  <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="dl">"</span><span class="s2">G</span><span class="dl">"</span><span class="p">:</span>
		  <span class="nx">result</span> <span class="o">=</span> <span class="nx">geometricSeriesSum</span><span class="p">(</span><span class="nx">a0</span><span class="p">,</span> <span class="nx">d_or_q</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
		  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">d_or_q_label</span><span class="dl">"</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">q</span><span class="dl">"</span><span class="p">;</span>
		  <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
  a0 = <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"textbox"</span> <span class="na">id=</span><span class="s">"a0"</span> <span class="na">value = </span><span class="s">"0"</span> <span class="na">onkeyup = </span><span class="s">"computeSum()"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"d_or_q_label"</span><span class="nt">&gt;</span>d<span class="nt">&lt;/span&gt;</span> = <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"textbox"</span> <span class="na">id=</span><span class="s">"d_or_q"</span> <span class="na">value = </span><span class="s">"0"</span> <span class="na">onkeyup = </span><span class="s">"computeSum()"</span><span class="nt">/&gt;</span>
  n = <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"textbox"</span> <span class="na">id=</span><span class="s">"n"</span> <span class="na">value = </span><span class="s">"0"</span> <span class="na">onkeyup = </span><span class="s">"computeSum()"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"type"</span> <span class="na">onchange = </span><span class="s">"computeSum()"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"A"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Arithmetic series<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"G"</span><span class="nt">&gt;</span>Geometric series<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;/select&gt;</span>
  <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
  Sum = <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"textbox"</span> <span class="na">id=</span><span class="s">"result"</span> <span class="na">value = </span><span class="s">"0"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

</div>

<p>בכל הנוגע לחישוב הסכומים, אני עושה לולאת for “קלאסית” ובזה נגמר העניין. כדי להחליט האם לעשות טור חשבוני או הנדסי אני משתמש במשפט case, אבל התחביר שלו בג’אווהסקריפט שונה ממה שיש ברובי. ראשית, לא כותבים case ואז משתנה, אלא switch ואז משתנה (או ביטוי כלשהו שמתפרש בתור ערך) בסוגריים; אחרי זה פותחים בלוק עם סוגריים מסולסלים, ובתוכו כותבים case ואז ערך ואז נקודותיים עבור כל מקרה שבו אנחנו רוצים לטפל. אלא שבג’אווהסקריפט (ובשפות נוספות כמו C ו-++C) יש למשפטי case כאלו גם תכונה שנקראת fall-through: מרגע ש-case כלשהו התקיים, אנחנו מפעילים את הקוד שלו ו<strong>גם את הקוד של כל המקרים שאחריו</strong> אלא אם עוצרים אותנו במפורש מלעשות את זה על ידי פקודת break כמו שיש לי שם. מה ההגיון כאן? ובכן, אין לי דוגמה טובה כרגע, אבל לפעמים זה שימושי. לרוע המזל, זה מאוד, מאוד מסוכן; זה פתח לבאגים איומים ונוראיים. אני רוצה לספר כאן על הבאג האיום והנורא החביב עלי מסוג זה: Yeenoghu.</p>

<p>אפשר לקרוא את הסיפור <a href="http://nethack.wikia.com/wiki/Yeenoghu">כאן</a>, אבל הנה תקציר: Yeenoghu הוא אחד מהשדים שנגדם נלחמים במשחק המחשב Nethack, שהוא משחק מבוכים מפורסם מאוד בקוד פתוח. יש לו התקפה מיוחדת שעושה משהו שאני לא זוכר, והוא נחשב לאויב סטנדרטי - לא קשוח יותר מדי (ביחס לכך שהוא שד ולכן נתקלים בו רק בשלב מתקדם במשחק). ואז עדכנו את Nethack והוסיפו למשחק את פרשי האפוקליפסה, ובראשם “מוות”. למוות יש התקפה מיוחדת שאם השחקן נפגע ממנה, הוא פשוט מת. זהו. אבל בשביל זה צריך שההתקפה המיוחדת תעבוד. לשם כך מתבצעת בדיקה מקדימה, ואם ההתקפה הצליחה, עוברים לקטע הקוד שהורג את השחקן.</p>

<p>קטע הקוד הזה נמצא בתוך משפט case ארוך שעוסק בשלל סוגים של התקפות מיוחדות. הרעיון הוא שאם התקפה מיוחדת הצליחה, עוברים ל-case הזה עם משתנה שאומר איזו התקפה הופעלה, ואז הקוד הרלוונטי עבורה מופעל. ועכשיו לעצם העניין - טרם העדכון, מייד אחרי הקוד של Yeenoghu הופיע הקוד שמטפל במקרה הכללי שבכל מקרה היה צריך להיות מופעל, ולכן לא היה break אחרי הקוד של Yeenoghu. ואז הוסיפו את ההתקפה המיוחדת של מוות אחרי הקוד של Yeenoghu ושכחו להוסיף break אצל Yeenoghu. התוצאה? Yeenoghu  הפך למפלצת קטלנית יותר מאשר מוות, כי ההתקפה המיוחדת של Yeenoghu היא בעלת סיכויי הצלחה גבוהים יותר, וכשהיא פוגעת - מופעל הקוד של Yeenoghu ומייד אחר כך הקוד של מוות, שפשוט הורג את השחקן.</p>

<p>ואנשים לא תפסו שזה מה שקורה. הם חשבו ש-Yeenoghu הורג אותם כי, ובכן, הוא מפלצת קשוחה. Yeenoghu  הפך לאימת המשחק. שחקנים קיללו את Yeenoghu. ואז אחד המפתחים הבחין בבאג ותיקן אותו חיש קל תוך שהוא מציין שזה באג מגוחך לחלוטין ולמה אף אחד לא הודיע לו.</p>

<p>אז חברים - כשאתם כותבים case בשפה כמו C, תזכרו את Yeenoghu! תשתמשו ב-break, תמיד!</p>

<p>אחרי הסיפור העגום הזה אפשר להסביר מה עוד עשיתי בקוד הג’אווהסקריפט. ראשית, איך המשתמש בוחר אם הוא רוצה סכום של סדרה חשבונית או הנדסית? הוא יכול להקליד “A” או “G” כמו קודם, אבל בשביל מה? חצי מהפואנטה בג’אווהסקריפט הוא שאפשר להשתמש בממשק שמוגדר כבר כך כחלק מהסטנדרט של HTML וכולל בתוכו, למשל, תיבות בחירה - Select. אז אני משתמש באחת כזו. ויש עוד תעלול: כזכור, את ההפרש של סדרה חשבונית אני מסמן ב-d ואת המנה אני מסמן ב-q; רציתי שבממשק ההטמלי הכיתוב של התיבה הרלוונטית ישתנה בהתאם לשאלה אם כרגע תיבת הבחירה היא על סדרה חשבונית או הנדסית. את השינוי הזה אני מבצע בתוך משפט ה-case שגם מחשב את הפלט שצריך להציג על המסך כרגע, מתוך הנחה (שיש בה הגיון אבל צריך להיות זהירים איתה) שתמיד מגיעים למשפט הזה אחרי שבוחרים את אחת מהסדרות בתיבת הבחירה.</p>

<p>זו אחת הסיבות שבגללן בחרתי בג’אווהסקריפט בתור השפה השלישית שלי - אני רוצה להציג עבודה עם ממשק (בסיסי מאוד, אמנם) ואת הרעיון של רכיבים שונים שקוראים אחד לשני ומפעילים אחד את השני. כאן אנחנו מתחילים לראות את זה.</p>

  </div>

  <hr />
  <p>
    נהניתם? התעניינתם? אם תרצו, אתם מוזמנים לתת טיפ:
  </p>
  <a href='https://ko-fi.com/H2H5XFBQ' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://az743702.vo.msecnd.net/cdn/kofi2.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a><div class="PageNavigation">
    
      <a class="prev" href="/2013/07/14/student_and_computer_9/">&laquo; פרוייקט "התלמיד והמחשב", בעיה 9</a>
    
    
      <a class="next" href="/2013/07/21/complex_analysis_intro/">אז מה זו אנליזה מרוכבת? &raquo;</a>
    
  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://gadial.net/2013/07/17/student_and_computer_10/';
      this.page.identifier = 'http://gadial.net/2013/07/17/student_and_computer_10/';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://not-precise.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/2013/07/17/student_and_computer_10/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">לא מדויק</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">לא מדויק</li><li><a class="u-email" href="mailto:gadial@gmail.com">gadial@gmail.com</a></li><li>&copy; כל הזכויות שמורות לגדי אלכסנדרוביץ'</li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.facebook.com/%D7%9C%D7%90-%D7%9E%D7%93%D7%95%D7%99%D7%A7-163347110378474"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg> <span class="username">לא מדויק</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>בלוג על מתמטיקה ומדעי המחשב</p>
      </div>
    </div>

  </div>

</footer><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="assets/js/jquery-slim.min.js"><\/script>')</script><script src="/assets/js/bootstrap.bundle.js"></script><!-- Default Statcounter code for New blog
http://www.gadial.net/ -->
<script type="text/javascript">
  var sc_project=5444342; 
  var sc_invisible=1; 
  var sc_security="4a89cbe4"; 
  </script>
  <script type="text/javascript"
  src="https://www.statcounter.com/counter/counter.js"
  async></script>
  <noscript><div class="statcounter"><a title="Web Analytics"
  href="https://statcounter.com/" target="_blank"><img
  class="statcounter"
  src="https://c.statcounter.com/5444342/0/4a89cbe4/1/"
  alt="Web Analytics"></a></div></noscript>
  <!-- End of Statcounter Code --></body>

</html>
