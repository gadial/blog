<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>המגדל הלוהט 2: הנקמה - לא מדויק</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <meta name="description" content="לא מדויק - בלוג על מתמטיקה ומדעי המחשב" />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://gadial.net/2007/09/09/towers_of_hanoi_solutions/">
    <meta property="og:title" content="המגדל הלוהט 2: הנקמה">
    <meta property="og:description" content="לא מדויק - בלוג על מתמטיקה ומדעי המחשב">
    <meta property="og:site_name" content="לא מדויק">
    <meta property="og:image" content="http://gadial.net/img/main/default-card.png" />
        
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://gadial.net/2007/09/09/towers_of_hanoi_solutions/">
    <meta name="twitter:description" content="לא מדויק - בלוג על מתמטיקה ומדעי המחשב">
    <meta name="twitter:site" content="@" />
    <meta property="twitter:title" content="המגדל הלוהט 2: הנקמה">
    <meta property="twitter:image" content="http://gadial.net/img/main/default-card.png" />
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="לא מדויק - RSS Feed" href="/feed.xml">
       
    
    <!-- Post-specific social media image -->
    
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', 'David', 'Tahoma', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        /* Top navigation bar */
        .top-nav {
            background: #2c3e50;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .top-nav .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .top-nav .site-title {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .top-nav .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .top-nav .nav-links a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
            white-space: nowrap;
        }
        
        .top-nav .nav-links a:hover {
            background: #34495e;
        }
        
        .top-nav .search-box {
            display: flex;
            gap: 5px;
        }
        
        .top-nav .search-box input {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            font-size: 0.9em;
            min-width: 150px;
        }
        
        .top-nav .search-box button {
            padding: 5px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .top-nav .search-box button:hover {
            background: #2980b9;
        }
        
        /* Hamburger menu button */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.8em;
            color: white;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        .menu-toggle:hover {
            opacity: 0.8;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .top-nav .nav-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .top-nav .site-title {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0;
                padding: 10px 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            /* Hide nav links by default on mobile */
            .top-nav .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                margin-top: 10px;
            }
            
            /* Show when expanded */
            .top-nav .nav-links.expanded {
                display: flex;
            }
            
            .top-nav .nav-links > a {
                text-align: center;
                padding: 12px;
                border-top: 1px solid rgba(255, 255, 255, 0.2);
            }
            
            .top-nav .search-box {
                width: 100%;
                flex-direction: column;
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid rgba(255, 255, 255, 0.2);
            }
            
            .top-nav .search-box input {
                width: 100%;
                margin-bottom: 5px;
                min-width: 0;
            }
            
            .top-nav .search-box button {
                width: 100%;
            }
        }
        
        /* Blockquote styling */
        blockquote {
            background: #f9f9f9;
            border-right: 5px solid #ccc;
            margin: 1.5em 10px;
            padding: 0.75em 16px;
            position: relative;
            font-style: italic;
        }
        
        blockquote:before {
            content: '"';
            position: absolute;
            top: -10px;
            right: 8px;
            font-size: 3.5em;
            color: #ccc;
            line-height: 1;
        }
        
        blockquote p {
            display: block;
            margin: 0 0 0.75em 0;
        }
        
        blockquote p:last-child {
            margin-bottom: 0;
        }
        
        
        body {
            line-height: 1.8;
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        header {
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .post-meta {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .post-meta .date {
            margin-left: 15px;
        }
        
        .post-meta .categories,
        .post-meta .tags {
            display: inline;
        }
        
        .post-meta .categories a,
        .post-meta .tags a {
            color: #3498db;
            text-decoration: none;
            margin: 0 5px;
        }
        
        .post-meta .categories a:hover,
        .post-meta .tags a:hover {
            text-decoration: underline;
        }
        
        article {
            font-size: 1.1em;
        }
        
        article h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #34495e;
            font-size: 1.8em;
        }
        
        article h3 {
            margin-top: 25px;
            margin-bottom: 12px;
            color: #34495e;
            font-size: 1.4em;
        }
        
        article p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        article ul, article ol {
            margin-right: 30px;
            margin-bottom: 15px;
        }
        
        article li {
            margin-bottom: 8px;
        }
        
        article code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        article pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 20px;
            direction: ltr;
            text-align: left;
        }
        
        article pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
        }
        
        /* Image styles - responsive and contained */
        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
        }
        
        /* Math rendering styles */
        .math {
            direction: ltr;
        }
        
        span.math {
            direction: ltr;
        }
        
        /* Override RTL for KaTeX */
        .katex {
            direction: ltr;
            unicode-bidi: embed;
        }
        
        /* Force KaTeX content to wrap by overriding its internal structure */
        .katex-html {
            display: inline !important;
            white-space: normal !important;
        }
        
        .katex .base {
            display: inline !important;
            white-space: normal !important;
        }
        
        .katex .mord,
        .katex .mbin,
        .katex .mrel,
        .katex .mopen,
        .katex .mclose,
        .katex .mpunct,
        .katex .minner {
            display: inline !important;
            white-space: normal !important;
        }
        
        div.math {
            display: block;
            text-align: center;
            padding: 15px 0;
            direction: ltr;
        }
        
        /* RTL adjustments for code blocks */
        .highlight {
            direction: ltr;
            text-align: left;
        }
        
        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #95a5a6;
            font-size: 0.9em;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            article {
                font-size: 1em;
            }
            
            /* Hide post navigation on mobile */
            .post-navigation {
                display: none;
            }
        }
        
        /* Post navigation */
        .post-navigation {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            gap: 20px;
        }
        
        .post-navigation .nav-link {
            flex: 1;
            text-decoration: none;
            color: #2c3e50;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            transition: background 0.2s;
        }
        
        .post-navigation .nav-link:hover {
            background: #e9ecef;
        }
        
        .post-navigation .nav-prev {
            text-align: right;
        }
        
        .post-navigation .nav-next {
            text-align: left;
        }
        
        .post-navigation .nav-label {
            font-size: 0.85em;
            color: #7f8c8d;
            display: block;
            margin-bottom: 5px;
        }
        
        .post-navigation .nav-title {
            font-weight: bold;
            font-size: 1.1em;
        }

    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="site-title">
                <a href="/" style="color: white; text-decoration: none;">לא מדויק</a>
                <button class="menu-toggle" onclick="toggleMobileMenu()" aria-label="תפריט">
                    ☰
                </button>
            </div>
            <div class="nav-links" id="navLinks">
                <a href="/">דף הבית</a>
                <a href="/random.html">פוסט אקראי</a>
                <a href="/post_list.html">כל הפוסטים</a>
                <a href="/categories/">קטגוריות</a>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="חיפוש...">
                    <button onclick="searchPosts()">חפש</button>
                </div>
            </div>
        </div>
    </nav>
    
    
    <div class="container">
        <!-- Post Navigation -->
        
        <nav class="post-navigation">
            
            <a href="/2007/09/07/towers_of_hanoi/" class="nav-link nav-prev">
                <span class="nav-label">פוסט ישן יותר →</span>
                <span class="nav-title">המגדל הלוהט</span>
            </a>
            

            
            <a href="/2007/09/12/ants_on_a_table/" class="nav-link nav-next">
                <span class="nav-label">← פוסט חדש יותר</span>
                <span class="nav-title">על נמלים, נזירים ומסלולים צרים</span>
            </a>
            
        </nav>
        
        
        <header>
            <h1>המגדל הלוהט 2: הנקמה</h1>
            <div class="post-meta">
                <span class="date">2007-09-09</span>
                
                <span class="categories">
                    | קטגוריות:
                    
                    <a href="/categories/משחקים וחידות מתמטיות.html">משחקים וחידות מתמטיות</a>
                    
                    <a href="/categories/תכנות.html">תכנות</a>
                    
                </span>
                
                
            </div>
        </header>
        
        <article>
            <p>בפוסט הקודם הבטחתי שני פתרונות לבעיית מגדלי האנוי - אחד "פשוט" ואחד רקורסיבי (ומכיוון שאינו "פשוט", משתמע שהוא מסובך). לטעמי דווקא הרקורסיבי הוא המעניין שבהם, מכיוון שהוא מסייע ביצירת הבחנה כלשהי בין רמת האבסטרקציה שיש לנו כשאנחנו כותבים תוכנות, ובין מה שהמחשב מבצע בפועל. האבסטרקציה הזו מושגת באמצעות רקורסיה.</p>
<p>רקורסיה, באופן כללי, היא פעולה שמוגדרת באמצעות עצמה - אבל כדי שלא תהיה לנו לולאה אינסופית, ההגדרה היא באמצעות גרסה "קצת יותר פשוטה" של עצמה, ועבור גרסה פשוטה מאוד של עצמה, היא מוגדרת ישירות. כך למשל <a href="http://he.wikipedia.org/wiki/%D7%A1%D7%93%D7%A8%D7%AA_%D7%A4%D7%99%D7%91%D7%95%D7%A0%D7%90%D7%A6'%D7%99">סדרת פיבונאצ'י</a> מוגדרת באמצעות רקורסיה: כל איבר בה שווה לסכום שני קודמיו פרט לשניים הראשונים, שמוגדרים להיות 0 ו-1 (או 1 ו-1, תלוי את מי שואלים). אם ה"פעולה" לא ברורה כל כך מההגדרה הזו, חישבו על הפעולה של "לחשב את האיבר ה-n בסדרת פיבונאצ'י" - כדי לבצע את הפעולה הזו, פרט למקרה הטריוויאלי שבו n=0 או n=1, תיאלצו לחשב קודם כל את שני האיברים הקודמים בסדרה - כלומר, לבצע את אותה הפעולה, אבל וריאציה "יותר פשוטה" עליה (בפועל אין בכך צורך כי יש נוסחה סגורה לסדרת פיבונאצ'י, אבל זה לא העניין כאן).</p>
<p>מה שכאן הוא רעיון מתמטי, הוא לחם וחמאה במדעי המחשב. רוב שפות התכנות המקובלות (כולן?) תומכות ברקורסיה, ויש כאלו שבהן היא מרכיב דומיננטי (למשל Scheme). הרקורסיה באה לידי ביטוי בשפות הללו באופן הבא: כל שפה מורכבת ממספר הוראות בסיס ("הכפל את המשתנה הזה בשתיים", "חלק אותו בשלוש", "הצב אותו במשתנה אחר") שמעליהן מתווספים <strong>מבני בקרה</strong> ("הכפל את המשתנה הזה בשתיים  <strong>עד אשר</strong> ערכו גדול מאלף", "<strong>אם</strong> המשתנה הזה אי זוגי, <strong>אז</strong> הכפל אותו בשתיים"). כל זה טוב ויפה אבל קיים (בערך) גם בשפות המכונה - השפות הבסיסיות שהמחשב "מבין".</p>
<p>מה שמבדיל את שפות המכונה מהשפות ה"עיליות" שבהן מתכנתים משתמשים רוב הזמן (למשל, ++C הידועה), הוא יכולת ה<strong>הפשטה</strong>. היכולת להסתיר פעולות מורכבות מאחורי מעטה פשוט. כך למשל, בשפת תכנות גבוהה אפשר לקחת סדרת פעולות בסיסיות שמטרתה לממש את <a href="http://he.wikipedia.org/wiki/%D7%A9%D7%99%D7%98%D7%AA_%D7%A0%D7%99%D7%95%D7%98%D7%95%D7%9F_%D7%A8%D7%A4%D7%A1%D7%95%D7%9F">אלגוריתם ניוטון רפסון</a> לחישוב שורש של מספר, לתת לה את השם הנאה "שורש", ומעכשיו להשתמש בה כפעולה בסיסית ("לקרוא לה"): "הוצא שורש למשתנה הבא ושים את התוצאה במשתנה ההוא". אפשר יהיה גם לעשות איתה דברים יותר מחוכמים - למשל, להעביר אותה כפרמטר לפונקציות אחרות ("קח את הפונקציה שהועברה כפרמטר ובצע לה אינטגרציה נומרית בקטע שבין אפס ואחד"). בין הדברים המחוכמים שאפשר לעשות יהיה להגיד לה לקרוא לעצמה, וכאן נכנסת הרקורסיה לעניין.</p>
<p>מכיוון שמימוש פונקציה שמחשבת את סדרת פיבונאצ'י על ידי רקורסיה הוא לא יעיל וזה לא לעניין, הנה פונקציה פשוטה ו"קלאסית" יותר - עצרת. עצרת מוגדרת על מספרים שלמים באופן הבא: 0 עצרת הוא 1, ואילו n עצרת הוא מכפלת כל המספרים הטבעיים (החל ב-1) ועד n כולל. באופן רקורסיבי ההגדרה פשוטה:</p>
<p><span class="math">\(f(n)=n\cdot f(n-1)\)</span></p>
<p><span class="math">\(f(0)=1\)</span></p>
<p>ולכן פונקציה רקורסיבית שמחשבת את עצרת תיראה בערך כך (בפסאודו-קוד):</p>
<p dir="ltr">function factorial(n)</p>
<p dir="ltr">if n=0 return 1</p>
<p dir="ltr">else return n*factorial(n-1)</p>
<p dir="ltr">end of function</p>
<p dir="rtl"> אני מקווה שהקוד קריא גם לאלו שאינם מכירים כלל תכנות. השורה הראשונה היא ה<strong>כותרת</strong> של הפונקציה: כתוב שם שהיא בכלל פונקציה, מה השם שלה (factorial), ומה הפרמטר שהיא מקבלת (n). בשורה הבאה בודקים האם מתקיים "תנאי ההתחלה" של <span class="math">\(n=0\)</span>. אם כן - הפונקציה מחזירה את הערך 1. אם לא, הפונקציה מחזירה <span class="math">\(n\)</span> כפול התוצאה של הפעלת עצמה על ערך מספרי קצת פשוט יותר - <span class="math">\(n-1\)</span>.</p>
<p dir="rtl">איך כל זה מתקשר למגדלי האנוי? כי קל לכתוב פונקציה רקורסיבית שפותרת אותם. הרעיון הוא כזה: אם יש לנו רק טבעת אחת להעביר, הפתרון פשוט: לוקחים אותה ומעבירים אותה בצעד אחד, וגמרנו. לעומת זאת, אם יש לנו יותר מ-2 טבעות, אפשר לחשוב על הפתרון הבא: אם נצליח להעביר את כל הטבעות חוץ מהתחתונה ביותר אל מוט העזר, גמרנו; כי אז נעביר את הטבעת התחתונה ביותר אל מוט היעד, ואז נעביר את כל שאר הטבעות אל מוט היעד גם כן. במילים אחרות, יש לנו "פונקציה" בעלת שלושה צעדים בלבד:</p>

<ol>
    <li>העבר את n-1 הטבעות העליונות ממוט המקור למוט העזר.</li>
    <li>העבר את הטבעת שנותרה במוט המקור למוט היעד.</li>
    <li>העבר את n-1 הטבעות ממוט העזר למוט היעד.</li>
</ol>
<p>כמובן, יש כאן רמאות; מה זה "העבר n-1 טבעות"? זה לא צעד בסיסי כמו "העבר טבעת אחת". זה בדיוק הצעד הרקורסיבי: אנחנו מפעילים את אותה הפונקציה בדיוק על n-1 הטבעות שנותרו - ובסופו של דבר נגיע למקרה הטריוויאלי, שבו צריך להעביר רק טבעת אחת, והוא נפתר בצעד בסיסי.</p>
<p>יש כאן נקודה עדינה. כדי שאפשר יהיה להפעיל את הרקורסיה, צריך שהתנאים שהתקיימו קודם עדיין יתקיימו. למה הכוונה? כשהפעלנו את הפונקציה לראשונה, הסיטואציה הייתה כזו שבה יש n טבעות על מוט אחד, ושני האחרים ריקים. כשאנחנו מפעילים את הרקורסיה בפעם השניה על n-1 הטבעות, זה כבר לא כך: אחד מהמוטות לא ריק, שכן הוא מכיל את הטבעת התחתונה ביותר. העניין הוא שניתן להתעלם מהטבעת הזו שכן היא לא מפריעה לביצוע אף פעולה - מכיוון שהיא התחתונה ביותר אפשר להניח עליה כל טבעת אחרת, ולכן אין הבדל בין הסיטואציה שבה היא קיימת, והסיטואציה שבה היא אינה קיימת. זוהי עוד דוגמה להפשטה - במקרה זה, היכולת להתעלם מפרטים לא רלוונטיים שנסיון להתחשבות בהם רק יסבך את הפתרון.</p>
<p>ישנם עוד כמה פרטים קטנים שיש להתחשב בהם כאן - אני משאיר כאתגר לקוראים לחשוב עליהם ולממש את הפונקציה בשפת תכנות "אמיתית" (אני ממליץ על Ruby או על Python)<br />
ועכשיו למה שהבטחתי - הפתרון הפשוט. יש לו כמה ניסוחים, ואבחר בזה שהכי נוח לי. נניח שהמוטות מסודרים במעגל, כך שיש משמעות למושג "הזז עם כיוון השעון". אז אלגוריתם שפותר את הבעיה הוא:</p>
<ol>
    <li>הזז את הטבעת הקטנה ביותר צעד אחד בכיוון השעון.</li>
    <li>בצע את ההזזה היחידה שניתן לבצע ואינה הזזה של הטבעת הקטנה.</li>
    <li>חזור ל-1 כל עוד לא סיימת.</li>
</ol>
<p>זה הכל. אפשר להוכיח באינדוקציה שזה עובד, אבל זה לא מעניין במיוחד. מה שחשוב כאן הוא שהאלגוריתם בנוי אך ורק על צעדים בסיסיים - הזזה של טבעת אחת בכל פעם - ואינו משתמש כלל ברקורסיה ובאבסטרקציות. לכן קל לאדם לבצע את הפתרון הזה, בעוד שאת הפתרון הרקורסיבי קשה (נסו להתחיל הפעלה ידנית של האלגוריתם עבור n=8 ובדקו לכמה נייר ועיפרון אתם זקוקים). גם מחשב יעדיף את הפתרון הזה - רקורסיות, במימוש הרגיל שלהן, דורשות הרבה זיכרון (בכל שלב של הרקורסיה, צריך לזכור את כל ההפעלות הקודמות של הפונקציה, ש"הביאו" אותנו לשלב הנוכחי, כי בסוף נצטרך לחזור אליהן כדי לסיים אותן). היתרון של הפתרון הרקורסיבי הוא בכך שברור מייד מדוע הוא עובד, והוא נראה טבעי יותר (לפחות עבורי).</p>
<p>עד כאן בכל הנוגע למגדלי האנוי. באשר לרקורסיה, אני מקווה שנפגוש בה גם בעתיד, ובהקשרים מעניינים יותר.</p>
        </article>
        
        <footer>
            <p>© כל הזכויות שמורות לגדי אלכסנדרוביץ'</p>
        </footer>
    </div>

    
    <script>
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('expanded');
        }
        
        function searchPosts() {
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm.trim()) {
                window.location.href = '/post_list.html?search=' + encodeURIComponent(searchTerm);
            }
        }
        
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPosts();
            }
        });
    </script>
    
    
    <!-- Auto-render KaTeX math -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "\\[", right: "\\]", display: true},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
        });
    </script>

</body>
</html>