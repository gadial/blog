<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בעיית איסוף הקופונים - לא מדויק</title>
    
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', 'David', 'Tahoma', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        /* Top navigation bar */
        .top-nav {
            background: #2c3e50;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .top-nav .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .top-nav .site-title {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .top-nav .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .top-nav .nav-links a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
            white-space: nowrap;
        }
        
        .top-nav .nav-links a:hover {
            background: #34495e;
        }
        
        .top-nav .search-box {
            display: flex;
            gap: 5px;
        }
        
        .top-nav .search-box input {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            font-size: 0.9em;
            min-width: 150px;
        }
        
        .top-nav .search-box button {
            padding: 5px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .top-nav .search-box button:hover {
            background: #2980b9;
        }
        
        
        body {
            line-height: 1.8;
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        header {
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .post-meta {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .post-meta .date {
            margin-left: 15px;
        }
        
        .post-meta .categories,
        .post-meta .tags {
            display: inline;
        }
        
        .post-meta .categories a,
        .post-meta .tags a {
            color: #3498db;
            text-decoration: none;
            margin: 0 5px;
        }
        
        .post-meta .categories a:hover,
        .post-meta .tags a:hover {
            text-decoration: underline;
        }
        
        article {
            font-size: 1.1em;
        }
        
        article h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #34495e;
            font-size: 1.8em;
        }
        
        article h3 {
            margin-top: 25px;
            margin-bottom: 12px;
            color: #34495e;
            font-size: 1.4em;
        }
        
        article p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        article ul, article ol {
            margin-right: 30px;
            margin-bottom: 15px;
        }
        
        article li {
            margin-bottom: 8px;
        }
        
        article code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        article pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 20px;
            direction: ltr;
            text-align: left;
        }
        
        article pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
        }
        
        /* Image styles - responsive and contained */
        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
        }
        
        /* Math rendering styles */
        .math {
            direction: ltr;
        }
        
        span.math {
            direction: ltr;
        }
        
        /* Override RTL for KaTeX */
        .katex {
            direction: ltr;
            unicode-bidi: embed;
        }
        
        div.math {
            display: block;
            text-align: center;
            padding: 15px 0;
            direction: ltr;
        }
        
        /* RTL adjustments for code blocks */
        .highlight {
            direction: ltr;
            text-align: left;
        }
        
        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #95a5a6;
            font-size: 0.9em;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            article {
                font-size: 1em;
            }
        }
        
        /* Post navigation */
        .post-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            gap: 20px;
        }
        
        .post-navigation .nav-link {
            flex: 1;
            text-decoration: none;
            color: #2c3e50;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            transition: background 0.2s;
        }
        
        .post-navigation .nav-link:hover {
            background: #e9ecef;
        }
        
        .post-navigation .nav-prev {
            text-align: right;
        }
        
        .post-navigation .nav-next {
            text-align: left;
        }
        
        .post-navigation .nav-label {
            font-size: 0.85em;
            color: #7f8c8d;
            display: block;
            margin-bottom: 5px;
        }
        
        .post-navigation .nav-title {
            font-weight: bold;
            font-size: 1.1em;
        }

    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="/" class="site-title">לא מדויק</a>
            <div class="nav-links">
                <a href="/">דף הבית</a>
                <a href="/random.html">פוסט אקראי</a>
                <a href="/post_list.html">כל הפוסטים</a>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="חיפוש...">
                    <button onclick="searchPosts()">חפש</button>
                </div>
            </div>
        </div>
    </nav>
    
    
    <div class="container">
        <header>
            <h1>בעיית איסוף הקופונים</h1>
            <div class="post-meta">
                <span class="date">2019-02-13</span>
                
                <span class="categories">
                    | קטגוריות:
                    
                    <a href="/categories/הסתברות.html">הסתברות</a>
                    
                </span>
                
                
                <span class="tags">
                    | תגיות:
                    
                    <a href="/tags/בעיית איסוף הקופונים.html">בעיית איסוף הקופונים</a>
                    
                    <a href="/tags/הסתברות.html">הסתברות</a>
                    
                    <a href="/tags/מספרים הרמוניים.html">מספרים הרמוניים</a>
                    
                    <a href="/tags/קבוע אוילר מסקרוני.html">קבוע אוילר מסקרוני</a>
                    
                </span>
                
            </div>
        </header>
        
        <article>
            <p>הנה לכם סיפור על איך בעיות מתמטיות צצות מעצמן. זה לא מכבר יצא לאוויר העולם משחק הוידאו Super Smash Bros. Ultimate שהוא נצר לשושלת ארוכה ומפוארת של משחקי מכות שמאחדים דמויות משלל משחקים בלתי קשורים בעליל על מנת שירביצו אחד לשני באווירה של כאוס מוחלט בשלל זירות שונות ומשונות שנלקחות גם כן משלל משחקים בלתי קשורים בעליל. המשחק הנוכחי החליט לקחת את המופרכות הזו לשיאים חדשים על ידי כך שיאגד את כל הדמויות והזירות מכל המשחקים שיצאו עד כה בסדרה, ויוסיף עוד. כתוצאה מכך יש לא פחות מ-103 זירות במשחק. מסך בחירת הזירות נראה כך:</p>
<p><img class="alignnone size-full wp-image-3748" src="/img/2019/02/gw44pdhlx3i11.png" alt="" width="1600" height="900" /></p>
<p>עם כל כך הרבה זירות, למי יש זמן לבחור בכלל? אני תמיד בוחר בסימן השאלה למעלה שבוחר אחת מ-103 הזירות באקראי, כך שיש הסתברות שווה לכל אחת מהזירות. והנה שמתי לב שגם עכשיו, אחרי חודשיים של משחק, עדיין קורה שאני משחק בזירה שאני לא זוכר שראיתי קודם. זה העלה אצלי את השאלה הבאה: תוך כמה סיבובים של המשחק אפשר לראות את כל הזירות?</p>
<p>ובכן, זו שאלה מוכרת בתורת ההסתברות שנקראת "בעיית איסוף הקופונים" (שם שלא הכרתי עד עכשיו). הרעיון אצל איסוף הקופונים דומה: נניח שחברת דגני בוקר יוצאת במבצע שבו בכל אריזה שלה יש קופון שנבחר באקראי מבין כמה אפשריים, ומי שאוסף את כל הקופונים זוכה בפרס - כמה אריזות דגנים צריך לקנות? כמובן, בניסוח הזה של הבעיה צריך לחדד את העובדה שלכל קופון יש הסתברות שווה להופיע; אם זה לא המצב, אז הניתוח המתמטי מסובך בהרבה, מעבר למה שאני רוצה לכסות בפוסט הזה.</p>
<p>בואו נתמודד עם בעיית הזירות האקראיות שלי; בשלב הראשון האתגר יהיה בכלל לנסח את השאלה בצורה נכונה. מה שברור מייד הוא שצריך <strong>לפחות</strong> 103 סיבובים של המשחק כדי לראות את כל הזירות. אם הייתי עובר על הזירות באופן שיטתי, זה גם כל מה שהייתי צריך; אבל אני מפקיד את השליטה בידי הגורל העיוור שמגריל לי זירה בכל פעם, ולכן בהחלט ייתכן שלא משנה כמה משחקים אשחק, <strong>תהיה זירה שלא אראה אף פעם</strong>. היא פשוט אף פעם לא תעלה בגורל. ההסתברות לכך היא אפסית ובהמשך נראה שהיא לא באמת משפיעה על החישוב, אבל לא חייבים ללכת לקיצוניות: נניח שב-102 הסיבובים הראשונים באמת ראיתי זירה חדשה בכל פעם, ואז במשחק ה-103 פתאום הוגרלה זירה שכבר ראיתי. זה כבר אומר שבמקרה הזה, אזדקק לפחות ל-104 סיבובים. אז מספר <strong>מדויק</strong> לא הולך לענות לשאלה שלי, כי מספר הסיבובים תלוי במזל שלנו. השאלה המדויקת יותר היא מה יהיה <strong>מספר הסיבובים הממוצע</strong>.</p>
<p>למה אני מתכוון בממוצע? נניח שניתן ל-10,000 שחקנים לשחק במשחק ולספר לנו כמה סיבובים חלפו עד שהם ראו את כל הזירות, ואז ניקח את הממוצע החשבוני של התוצאות הללו - כלומר, נחבר את כולן ונחלק במספר השחקנים, שהוא 10,000: מה המספר שנקבל אז? על פי רוב נקבל מספרים שהם כמעט זהים; <strong>חוק המספרים הגדולים</strong> בהסתברות מבטיח לנו את זה.</p>
<p>כמובן, אין טעם באמת לתת לשחקנים לשחק; אפשר לעשות משהו מהיר יותר - סימולציה במחשב. אז הנה קוד בשפת פייתון שעושה בדיוק את זה:</p>
<div class="code-block">

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">def</span><span class="w"> </span><span class="nf">experiment</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">visited</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">visited_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rounds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">visited_count</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">rounds</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">visited_count</span> <span class="o">+=</span> <span class="mi">1</span>           
    <span class="k">return</span> <span class="n">rounds</span>

<span class="n">tries</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">103</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tries</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">experiment</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">total</span> <span class="o">/</span> <span class="n">tries</span><span class="p">)</span>
</code></pre></div>


</div>

<p>כשהרצתי את הקוד לקח לו רגע לסיים ובסוף קיבלתי את התוצאה <span class="math">\(535.3524\)</span>. בהרצה נוספת קיבלתי <span class="math">\(540.0647\)</span>. זה כבר מעורר את החשד ש-10,000 זה לא מספיק ואולי עדיף 100,000 הרצות בשביל תוצאה מדויקת יותר. אז הרצתי גם 100,000 פעמים, זה לקח יותר זמן וקיבלתי <span class="math">\(537.58746\)</span>. האם אפשר יותר מדויק, יותר מהר? ובכן, כן! אם נכניס לתמונה את תורת ההסתברות. כמו כן, כדי לפשט לעצמנו קצת את החיים נפסיק לדבר על המספר 103 דווקא ונדבר על מספר <span class="math">\(N\)</span> כללי.</p>
<p>יש לי <a href="https://gadial.net/2010/07/29/probability_intro/">פוסטים מפורטים יותר</a> בבלוג על תורת ההסתברות כך שלא אחזור על כל הפרטים כעת, אבל הנה הרעיון. כשאנחנו באים למדל משהו באמצעות תורת ההסתברות אנחנו קודם כל מגדירים <strong>מרחב מדגם</strong> שכולל את כל התוצאות האפשריות של ההגרלה שאנחנו מבצעים. במקרה הנוכחי אפשר לחשוב על הסיטואציה כאילו אנחנו מגרילים סדרה של זירות (שיכולה להיות סופית או אינסופית), כך שכל סדרה מסתיימת אחרי שכל זירה הופיעה לפחות פעם אחת. סדרה אינסופית מצביעה על כישלון - שיש זירה אחת לפחות שלא נראתה אף פעם. אפשר להראות שההסתברות של סדרה אינסופית שכזו היא אפס; זה לא אומר שאין סיכוי שהיא תופיע, רק שהסיכוי הזה <strong>זניח</strong> (הסבר מלא יותר יצטרך להיכנס לעובי הקורה הטכני של מרחבי הסתברות רציפים).</p>
<p>עכשיו אפשר להגדיר על מרחב ההסתברות שלנו <strong>משתנה מקרי</strong>. משתנה מקרי זו פונקציה שלוקחת תוצאה ממרחב המדגם ומחזירה ערך מספרי כלשהו שהיא מסמלת - במקרה הזה, אפשר להתאים לכל סדרה פשוט את האורך שלה. נסמן את המשתנה המקרי הזה ב-<span class="math">\(X\)</span>. עכשיו אפשר לשאול שאלה כמו "מה ההסתברות שאם נגריל סדרה כלשהי, הערך של <span class="math">\(X\)</span> יהיה לפחות 17?". ואפשר גם לשאול מה יהיה הערך <strong>הממוצע</strong> של <span class="math">\(X\)</span>. בתורת ההסתברות קוראים לערך ממוצע כזה <strong>התוחלת</strong> של <span class="math">\(X\)</span>, מסמנים אותו ב-<span class="math">\(E\left[X\right]\)</span> והוא מוגדר ככה: <span class="math">\(E\left[X\right]=\sum_{a}a\cdot\text{P}\left(X=a\right)\)</span>, כלומר - זה סכום משוקלל של כל הערכים <span class="math">\(a\)</span> שהמשתנה המקרי עשוי להחזיר, כשהמשקל של כל <span class="math">\(a\)</span> כזה הוא ההסתברות ש-<span class="math">\(X\)</span> יחזיר אותו.</p>
<p>מה שאני רוצה לעשות מכאן והלאה הוא לחשב את <span class="math">\(E\left[X\right]\)</span> עבור בעיית הקופונים שלנו. לצורך כך אני אעזר בתכונה מועילה במיוחד: <strong>לינאריות התוחלת</strong>. מה שלינאריות התוחלת אומרת הוא פשוט מאוד: <span class="math">\(E\left[X+Y\right]=E\left[X\right]+E\left[Y\right]\)</span>. כלומר: אם יש לנו שני משתנים מקריים, <span class="math">\(X,Y\)</span>, ואנחנו בונים משתנה מקרי חדש שהוא סכום של שניהם (כלומר: לכל איבר במרחב המדגם הוא מפעיל את <span class="math">\(X,Y\)</span> על האיבר הזה, מקבל תוצאות ומחבר אותן) אז התוחלת של המשתנה החדש תהיה הסכום של התוחלות של המשתנים. ההוכחה של לינאריות התוחלת לא קשה, אבל לא אציג אותה כאן.</p>
<p>איך זה עוזר לנו? ראשית, אם זה עובד לשני משתנים, זה עובד לכל מספר סופי של משתנים: אם <span class="math">\(X=X_{1}+X_{2}+\dots+X_{N}\)</span> אז <span class="math">\(E\left[X\right]=E\left[X_{1}\right]+E\left[X_{2}\right]+\dots+E\left[X_{N}\right]\)</span>. שנית, אני טוען שאת ה-<span class="math">\(X\)</span> שלנו של בעיית הקופונים אכן אפשר להציג בתור סכום שכזה. הרעיון? המשתנה <span class="math">\(X_{i}\)</span> סופר את מספר הסיבובים שנדרשו כדי להעלות את מספר הזירות שראינו עד כה מ-<span class="math">\(i-1\)</span> אל <span class="math">\(i\)</span>.</p>
<p>בצורה הזו ברור ש-<span class="math">\(X\)</span> הוא אכן הסכום המבוקש: <span class="math">\(X\)</span> הוא מספר הסיבובים הכולל שנדרש כדי להעלות את מספר הזירות שראינו מ-0 אל <span class="math">\(N\)</span>; זה שווה לזמן שנדרש כדי לעלות מ-0 אל 1, ועוד הזמן שנדרש לעלות מ-1 אל 2 וכן הלאה עד אשר הגענו מ-<span class="math">\(N-1\)</span> אל <span class="math">\(N\)</span>.</p>
<p>כל מה שנותר לעשות הוא לחשב את <span class="math">\(E\left[X_{i}\right]\)</span> - תוחלת הזמן שנדרשת כדי להעלות את מספר הזירות שראינו כבר מ-<span class="math">\(i-1\)</span> אל <span class="math">\(i\)</span>. אלא שאת זה קל לעשות כי <span class="math">\(X_{i}\)</span> הוא <strong>משתנה גאומטרי</strong>, וזה מושג מוכר ואהוב מתורת ההסתברות. משתנה גאומטרי מתעסק בשאלה "אם מטילים שוב ושוב את אותה הקוביה, כמה זמן יעבור עד שנקבל 1"? באופן כללי יותר, משתנה גאומטרי מדבר על הסיטואציה שבה יש ניסוי עם הסתברות <span class="math">\(p\)</span> להצליח, ואנחנו חוזרים עליו שוב ושוב עד אשר הוא מצליח וסופרים כמה נסיונות נדרשו לנו.</p>
<p>את התוחלת של הדבר הזה אפשר לחשב בעזרת הנוסחה <span class="math">\(E\left[X\right]=\sum_{a}a\cdot\text{P}\left(X=a\right)\)</span> והיכרות כלשהי עם סכומים אינסופיים. ההוכחה תהיה קצת טכנית ואפשר לדלג עליה מבלי לפגוע בהמשך הפוסט.</p>
<p><span class="math">\(\text{P}\left(X=1\right)\)</span> הוא <span class="math">\(p\)</span> (ההסתברות שנצליח בניסוי הראשון).</p>
<p><span class="math">\(\text{P}\left(X=2\right)\)</span> הוא <span class="math">\(\left(1-p\right)p\)</span> (ההסתברות <strong>שניכשל</strong> בניסוי הראשון - זה ה-<span class="math">\(\left(1-p\right)\)</span> - כפול ההסתברות שנצליח בניסוי השני).</p>
<p><span class="math">\(\text{P}\left(X=3\right)\)</span> הוא <span class="math">\(\left(1-p\right)^{2}p\)</span> ומכאן כבר אפשר לראות את הכיוון הכללי:</p>
<p><span class="math">\(E\left[X\right]=\sum_{n=1}^{\infty}n\text{P}\left[X=n\right]=\sum_{n=1}^{\infty}n\cdot p\cdot\left(1-p\right)^{n-1}=p\sum_{n=1}^{\infty}n\left(1-p\right)^{n-1}\)</span></p>
<p>וכעת מגיע להטוט לא טריוויאלי. בואו נכתוב שוב את הטור שיש לנו, אבל עם סימונים קצת שונים:</p>
<p><span class="math">\(\sum_{n=1}^{\infty}nx^{n-1}\)</span></p>
<p>אלו מכם שמכירים חדו"א אולי מזהים שהאיבר שנמצא בתוך הטור נראה כמו <strong>נגזרת</strong> לפי <span class="math">\(x\)</span> של פונקציה. כלומר, אפשר לכתוב</p>
<p><span class="math">\(\sum_{n=1}^{\infty}nx^{n-1}=\sum_{n=1}^{\infty}\left(x^{n}\right)^{\prime}=\left(\sum_{n=1}^{\infty}x^{n}\right)^{\prime}\)</span></p>
<p>המעבר האחרון, שבו "הוצאתי את הנגזרת החוצה מהסכום" הוא לא טריוויאלי ודורש הצדקות בחדו"א - אבל במקרה הזה, זה עובד. עכשיו מה שקיבלנו בתוך הסכום הוא <strong>טור גאומטרי</strong> בסיסי שאנחנו יודעים את הנוסחה שלו:</p>
<p><span class="math">\(\sum_{n=1}^{\infty}x^{n}=\frac{x}{1-x}\)</span></p>
<p>הנוסחה הזו עובדת רק עבור <span class="math">\(\left|x\right|&amp;lt;1\)</span>, אבל מכיוון שנציב <span class="math">\(x=1-p\)</span> ואנחנו מניחים ש-<span class="math">\(p&amp;gt;0\)</span> זו לא בעיה.</p>
<p>לבסוף, צריך עדיין <strong>לגזור</strong> את <span class="math">\(\frac{x}{1-x}\)</span>. הנגזרת יוצאת <span class="math">\(\frac{\left(1-x\right)+x}{\left(1-x\right)^{2}}=\frac{1}{\left(1-x\right)^{2}}\)</span>, וכשנציב <span class="math">\(x=1-p\)</span> חזרה נקבל</p>
<p><span class="math">\(p\sum_{n=1}^{\infty}n\left(1-p\right)^{n-1}=\frac{p}{\left(1-\left(1-p\right)\right)^{2}}=\frac{p}{p^{2}}=\frac{1}{p}\)</span></p>
<p>וכעת אפשר לחזור אל בעיית הקופונים שלנו. ראינו כבר ש-<span class="math">\(E\left[X\right]=E\left[X_{1}\right]+E\left[X_{2}\right]+\dots+E\left[X_{N}\right]\)</span>. נשאר רק להבין - לכל <span class="math">\(X_{i}\)</span>, מהו <span class="math">\(p\)</span> שלו? מה ההסתברות להצליח?</p>
<p>הניסוי של <span class="math">\(X_{i}\)</span> מצליח אם אנחנו מעלים בגורל זירה חדשה שטרם עלתה בגורל. עד כה עלו בגורל <span class="math">\(i-1\)</span> זירות, מה שאומר שנותרו עוד <span class="math">\(N-\left(i-1\right)\)</span> זירות. מספר הזירות הכולל הוא <span class="math">\(N\)</span>, ולכן ההסתברות להעלות בגורל את אחת מהזירות החדשות היא <span class="math">\(\frac{N-\left(i-1\right)}{N}\)</span>. כלומר:</p>
<p><span class="math">\(E\left[X_{i}\right]=\frac{1}{p_{i}}=\frac{N}{N-\left(i-1\right)}\)</span></p>
<p>כלומר:</p>
<p><span class="math">\(E\left[X_{1}\right]=\frac{N}{N}=1\)</span></p>
<p><span class="math">\(E\left[X_{2}\right]=\frac{N}{N-1}\)</span></p>
<p>וכן הלאה עד <span class="math">\(E\left[X_{N}\right]=\frac{N}{N-\left(N-1\right)}=\frac{N}{1}\)</span>.</p>
<p>וקיבלנו:</p>
<p><span class="math">\(E\left[X\right]=\sum_{i=0}^{N-1}\frac{N}{N-i}=N\sum_{i=0}^{N-1}\frac{1}{N-i}=N\sum_{i=1}^{N}\frac{1}{i}\)</span></p>
<p>וכאן אנחנו פוגשים חברים ותיקים (של חלקנו...). הסכום <span class="math">\(\sum_{i=1}^{N}\frac{1}{i}\)</span> (ובסימון אחר: <span class="math">\(1+\frac{1}{2}+\frac{1}{3}+\dots+\frac{1}{N}\)</span>) הוא כל כך חשוב שהוא זוכה לאות מיוחדת משלו: <span class="math">\(H_{N}=\sum_{i=1}^{N}\frac{1}{i}\)</span>, והמספר הזה נקרא <strong>המספר ההרמוני</strong> ה-<span class="math">\(N\)</span>-י. אלו מספרים מוכרים ואהובים שצצים במתמטיקה בשלל הזדמנויות, כך שלומר שפתרון בעיית הקופונים הוא שתוחלת הזמן עבור <span class="math">\(N\)</span> קופונים היא <span class="math">\(N\cdot H_{N}\)</span> היא פתרון קביל בהחלט.</p>
<p>אבל בואו ננסה לשכנע אתכם עוד קצת שזה אחלה פתרון.</p>
<p>כזכור, התחלתי את הדיון עם סוגייה קונקרטית - כמה סיבובים של Super Smash Bros. Ultimate צריך בתוחלת כדי לראות את כל הזירות? ועוד לפני שהכנסתי את תורת ההסתברות לתמונה ניסיתי לתת תשובה "אמפירית" לשאלה הזו על ידי קוד שמבצע סימולציות ומחשב ממוצעים. הקוד הזה <strong>עובד</strong>, אבל יש לו שני חסרונות ברורים:</p>
<ol>
    <li>לוקח לו הרבה זמן לרוץ, יחסית.</li>
    <li>התוצאה שהוא מחזיר היא <strong>קירוב</strong> של התוחלת, לא הערך המדויק שלה.</li>
</ol>
<p>הנוסחה שמצאתי עכשיו, <span class="math">\(N\cdot H_{N}\)</span>, לא נותנת קירוב של התוחלת אלא את התוחלת עצמה, במדויק; אבל עוד יותר חשוב מכך, אפשר לחשב אותה <strong>מהר</strong>, בשורה אחת של פייתון:</p>
<div class="code-block">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
</code></pre></div>


</div>

<p>השורה הזו מחזירה את המספר <span class="math">\(537.3294902186476\)</span> שהוא התוחלת ה"נכונה"; אפשר לראות שתוצאת הניסוי שעשיתי קודם יצאה קרובה מאוד (537 ומשהו) אבל בשביל זה הייתי צריך להקפיץ את מספר החזרות על הניסוי מ-10,000 (שלא נתן משהו עד כדי כך מדויק) אל 100,000 וזה לקח הרבה יותר זמן. הפתרון המדויק שמצאתי הוא <strong>יעיל יותר לחישוב</strong> ולכן טוב יותר. אני מדגיש את הנקודה הזו כי הפתרון הזה הוא לא "נוסחה סגורה" - יש בו סכום שתלוי ב-<span class="math">\(N\)</span>, ועשויה להיות רתיעה מסכומים כאלו למי שרגילים לתרגילים מקומבינטוריקה בסיסית שבהם לתת נוסחה שכזו לפעמים גורם להורדת נקודות כי זה לא פתרון פשוט "מספיק". ובכן, אם אתם סובלים (כמו שאני סבלתי) מטראומה כזו מסכומים - אל! סכומים יכולים להיות מאוד מועילים לפעמים (ודוגמא טובה מאוד היא <strong>עקרון ההכלה וההפרדה</strong> <a href="https://gadial.net/2011/12/31/inclusion_exclusion_principle/">שכתבתי עליו כבר פוסט</a>, ומאפשר להמיר בעיות חישוביות קשות למדי במשימות חישוביות הרבה יותר קלות למרות שהוא מתבסס על סכום).</p>
<p>אבל יש לנוסחה שהגענו אליה עוד יתרון - קיים לה <strong>קירוב</strong> טוב מאוד, שנובע מכמה טוב אנחנו מבינים מספרים הרמוניים. אפשר להראות (אין לי מושג איך - צריך יהיה לכתוב על זה פעם פוסט!) שמספרים הרמוניים מתנהגים "בערך" כמו הלוגריתם הטבעי. קצת יותר בפירוט:</p>
<p><span class="math">\(H_{N}\approx\ln N+\gamma+\frac{1}{2N}\)</span></p>
<p>כאשר <span class="math">\(\gamma=0.5772156649\dots\)</span> נקרא <strong>קבוע אוילר-מסקרוני</strong> והוא מספר מעניין בפני עצמו (למשל: עד היום אנחנו לא יודעים אם הוא רציונלי או לא).</p>
<p>אם נכפיל את הנוסחה הזו ב-<span class="math">\(N\)</span>, נקבל את הקירוב הבא לבעיית הקופונים:</p>
<p><span class="math">\(N\ln N+\gamma N+\frac{1}{2}\)</span></p>
<p>וזו נוסחה ש<strong>מאוד קל</strong> לחשב ביעילות, גם אם הערך של <span class="math">\(N\)</span> הוא אדיר (בן מאות ספרות - מה שמונע לגמרי חישוב של הסכום <span class="math">\(1+\frac{1}{2}+\dots+\frac{1}{N}\)</span>). ככל ש-<span class="math">\(N\)</span> גדול יותר כך הקירוב יהיה טוב יותר; עד כמה הוא טוב עבור <span class="math">\(N=103\)</span>? ובכן, הבה וננסה:</p>
<div class="code-block">

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.5772156649</span>
<span class="nb">print</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>


</div>

<p>הקוד הזה, עבור <span class="math">\(N=103\)</span>, מניב את התוצאה <span class="math">\(537.3302992723525\)</span> שהיא קרובה להפליא אל התוצאה המדויקת, והחישוב שלה כמובן מהיר יותר. אם אני אנסה להריץ את החישובים הקודמים עבור <span class="math">\(N=1000000000000000\)</span> אני אכשל בצורה מזעזעת (הקוד ירוץ וירוץ ולעולם לא יסיים) אבל עם הקירוב הזה אני עדיין אקבל תוצאה תוך חלקיק שניה - ואני יודע שזו תהיה תוצאה שלא אוכל להבדיל בינה ובין התוצאה ה"אמיתית".</p>
<p>זה סוגר את בעיית הקופונים הבסיסית, אבל כמובן שמכאן והלאה המתמטיקאים משתוללים עם שלל וריאציות: מה אם לא כל קופון הוא בעל אותה הסתברות להיבחר? מה אם אנחנו לא קונים קופונים אלא מנסים להשלים את כל המדבקות באלבום של "חבורת הזבל" (כן! היה משהו כזה!) ובכל חבילת מדבקות שאנחנו קונים יש שש מדבקות ולא רק אחת? וכן הלאה וכן הלאה. אבל אני לא אתעסק בזה עכשיו ומקווה שתסלחו לי; יש לי 537 סיבובים של Super Smash Bros. Ultimate לשחק בהם.</p>
        </article>
        
        <!-- Post Navigation -->
        
        <nav class="post-navigation">
            
            <a href="/2019/03/23/math_based_on_logical_fallacies/" class="nav-link nav-next">
                <span class="nav-label">→ פוסט חדש יותר</span>
                <span class="nav-title">האם כל המתמטיקה בעצם מבוססת על כשלים לוגיים?</span>
            </a>
            
            
            
            <a href="/2019/02/11/what_is_quantum_computer/" class="nav-link nav-prev">
                <span class="nav-label">פוסט ישן יותר ←</span>
                <span class="nav-title">אז מה זה מחשב קוונטי?</span>
            </a>
            
        </nav>
        
        
        <footer>
            <p>בלוג מתמטיקה בעברית</p>
        </footer>
    </div>

    
    <script>
        function searchPosts() {
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm.trim()) {
                window.location.href = '/post_list.html?search=' + encodeURIComponent(searchTerm);
            }
        }
        
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPosts();
            }
        });
    </script>
    
    
    <!-- Auto-render KaTeX math -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "\\[", right: "\\]", display: true},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
        });
    </script>

</body>
</html>