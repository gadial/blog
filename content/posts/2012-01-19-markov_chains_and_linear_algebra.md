---
id: 1484
title: "איך אלגברה לינארית מתקשרת לשרשראות מרקוב (ואיך כל זה קשור לגוגל)"
date: 2012-01-19 11:18:24
layout: post
categories: 
  - אלגברה לינארית
  - הסתברות
tags: 
  - PageRank
  - אלגברה לינארית
  - המתמטיקה למען האנושות
  - הסתברות
  - משפט פרון-פרובניוס
  - ערכים עצמיים
  - שרשראות מרקוב
---
<h2><strong>שרשראות מרקוב</strong></h2>
סדרת הפוסטים על אלגברה לינארית הגיעה במזל טוב לנקודה שבה אפשר לעצור ולעשות סיכומי ביניים לפני שצוללים בחומר הכבד הבא (מכפלות פנימיות), ולכן אני רוצה לנצל את ההזדמנות ולהציג נושא שהזכרתי בחטף קודם ולא דורש ידע באלגברה לינארית שטרם הוצג - שרשראות מרקוב. זה נושא ששייך לתורת ההסתברות ולכן הצגה פורמלית עד הסוף שלו תדרוש ממני לגלוש למונחים בהסתברות שעשויים לחסל קוראים שבסך הכל רוצים לראות שימוש מגניב באלגברה לינארית, ולכן אמנע עד כמה שאפשר מהם. מכיוון שאני עושה רק דברים פשוטים, איכשהו אצא מזה בשלום. או שלא.

שרשרת מרקוב היא מערכת מתמטית שמתארת התפתחות אקראית של תהליך לאורך זמן, בתנאי שלאותו תהליך יש תכונה של "חוסר זכרון" - העתיד של התהליך נקבע (אקראית) רק על פי ההווה, בלי תלות בעבר. ברקע תמיד יש קבוצה (סופית או בת-מניה) של "מצבים" אפשריים שבהם התהליך יכול להימצא בכל רגע נתון, והמצב הבא שאליו התהליך יגיע תלוי אך ורק במצב הנוכחי שלו ולא באופן שבו הוא הגיע למצב זה.

הנה דוגמה פשוטה: נניח שאתם מטילים קוביה שוב ושוב ושוב ולאחר כל הטלה רושמים את הסכום של כל ההטלות עד כה. התהליך הזה הוא שרשרת מרקוב; המצבים מתוארים על ידי הסכום הנוכחי שלכם, כלומר יש מצב לכל מספר טבעי. אם כרגע הסכום שלכם הוא 42, הרי שההסתברות שמכאן תגיעו אל 45 היא {% equation %}\frac{1}{6}{% endequation %} (ההסתברות שיצא לכם בדיוק "3" בהטלת הקוביה), וזה בכלל לא משנה אם הגעתם ל-42 על ידי 7 הטלות רצופות של "6" או על ידי 42 הטלות רצופות של "1" או כל סדרה אחרת של מספרים. מרגע שהגעתם ל-42, ולא משנה איך, המשך התהליך יתנהג (הסתברותית) באותו אופן בדיוק.

ההגדרה נראית פשוטה, אבל היא למעשה חמקמקה למדי כי אפשר למדל באמצעות שרשרת חסרת זכרון גם תהליכים שנראים כאילו הם בעלי זכרון ועוד איך. הנה דוגמה: נניח שאנחנו משנים את חוקי משחק הקוביה שלנו כך שבפעם השניה שבה מוטל "1" הסכום שלנו מתאפס, ולא משנה כמה זמן עבר מאז ההטלה הראשונה של 1 (ואחר כך שוב פעם - אם יוצא 1 ממשיכים כרגיל, אבל אם יוצא 1 לאחר מכן, מאפסים את הסכום וחוזר חלילה). לכאורה יש כאן זכרון ועוד איך; אלא שאפשר למדל את המצבים שלנו בתור <strong>זוגות</strong> מהצורה {% equation %}\left(n,a\right){% endequation %} כאשר {% equation %}n{% endequation %} הוא מספר טבעי כלשהו - הניקוד שלנו - ו-{% equation %}a{% endequation %} הוא 0 או 1 - משתנה ש"זוכר" אם כבר יצא 1 מאז האיפוס האחרון או לא. די ברור שבהינתן {% equation %}\left(n,a\right){% endequation %}, המשך התהליך לא תלוי באופן שבו הגענו למצב {% equation %}\left(n,a\right){% endequation %}, אלא רק במצב זה עצמו. הלקח הוא שעל ידי מידול חכם, אפשר לתאר עם שרשרת מרקוב המון, המון דברים.

יש כמה סוגים שונים של שרשראות מרקוב, כשההבדל המרכזי בתיאוריה הוא בין שרשרת בזמן בדיד - שבה ה"זמן" מתואר על ידי מספרים טבעיים ("הצעד הראשון, הצעד השני, הצעד השלישי...") לעומת שרשרת בזמן רציף, שבה הזמן הוא מספר ממשי. התיאוריה של המקרה הרציף מורכבת קצת יותר (אם כי דומה לזו של זמן בדיד) ואני לא הולך לדבר עליה בכלל. כמו כן, צריך להבדיל בין שרשראות שמרחב המצבים שלהן סופי, ואלו שמרחב המצבים שלהן אינו סופי (כמו השרשרת של המשחק שהצגתי זה עתה). דוגמה קלאסית לשרשרת עם מרחב מצבים סופי היא משחק "סולמות ונחשים" - המשבצות הן המצבים, ומעבר נקבע בהטלת קוביה (ועל פי הסולמות והנחשים, כמובן).

אני הולך לדבר רק על שרשראות שמרחב המצבים שלהן סופי, כי שרשראות כאלו ניתנות לתיאור באמצעות <strong>מטריצות</strong>. זאת מכיוון שאפשר לחשוב על כל שרשרת מרקוב בזמן בדיד בתור <strong>הילוך בגרף</strong> מכוון, כאשר הצמתים של הגרף הם המצבים של השרשרת, ועל הקשתות יש משקלים שמתאימים להסתברות המעבר בין צומת אחד לשני. לצורך פשטות, מסמנים את המצבים במספרים מ-1 ועד {% equation %}n{% endequation %}, ואז אפשר לתאר את השרשרת בעזרת מטריצה {% equation %}P{% endequation %} מסדר {% equation %}n\times n{% endequation %} כך ש-{% equation %}P_{ij}{% endequation %} היא ההסתברות לעבור מהמצב {% equation %}i{% endequation %} למצב {% equation %}j{% endequation %}. הנה דוגמה לאיך שזה נראה:

<strong><a href="{{site.baseurl}}{{site.post_images}}/2012/01/markov1.png"><img class="alignnone size-full wp-image-1487" title="markov1" alt="" src="{{site.baseurl}}{{site.post_images}}/2012/01/markov1.png" width="177" height="184" /></a>
</strong>

המטריצה המתאימה כאן היא {% equation %}P=\left(\begin{array}{ccc}\frac{1}{3} & \frac{1}{3} & \frac{1}{3}\\\frac{1}{2} & 0 & \frac{1}{2}\\1 & 0 & 0\end{array}\right){% endequation %}. שימו לב לכך שבמטריצה הזו סכום כל שורה הוא 1. זה לא במקרה; השורה ה-{% equation %}i{% endequation %} מייצגת את ההסתברויות לעבור מ-{% equation %}i{% endequation %} לכל אחד מהמצבים האחרים (או להישאר במקום, מה שממודל בתור מעבר ל-{% equation %}i{% endequation %}). מכיוון שאחד מאלו <strong>חייב</strong> לקרות, סכום כל ההסתברויות הוא בדיוק 1. למטריצה כזו, ששורותיה מסתכמות כולן ל-1, קוראים <strong>מטריצה סטוכסטית</strong>, ועוד נראה חשיבות לתכונה הזו בהמשך.

בפוסט שדיבר על כפל מטריצות הזכרתי את העובדה שאם {% equation %}A{% endequation %} היא מטריצה מייצגת של גרף - כלומר, אם {% equation %}A_{ij}{% endequation %} שווה ל-1 כשיש קשת מ-{% equation %}i{% endequation %} אל {% equation %}j{% endequation %} ו-0 אם אין כזו, אז {% equation %}A_{ij}^{k}{% endequation %} הוא מספר המסלולים מאורך {% equation %}k{% endequation %} מ-{% equation %}i{% endequation %} אל {% equation %}j{% endequation %} בגרף. מאותו נימוק ואותה הוכחה (שלא אכנס לפרטיה כאן אבל היא תרגיל מצויין לספקנים) אפשר לראות ש-{% equation %}P_{ij}^{k}{% endequation %} היא בדיוק ההסתברות לעבור מהמצב {% equation %}i{% endequation %} למצב {% equation %}j{% endequation %} אחרי {% equation %}k{% endequation %} צעדים; כלומר, אם התחלנו את השרשרת שלנו כאשר אנחנו במצב {% equation %}i{% endequation %}, וביצענו {% equation %}k{% endequation %} צעדים, אז ההסתברות שבסוף ההרפתקאה הזו נהיה ב-{% equation %}j{% endequation %} היא בדיוק, אבל בדיוק {% equation %}P_{ij}^{k}{% endequation %}. אני מאוד מקווה שהתוצאה הזו נראית לכם טריוויאלית לחלוטין; עכשיו עצרו לרגע וחשבו שאנחנו חיים בעולם ללא מטריצות וללא כפל מטריצות, וחשבו כיצד בעולם כזה היה נראה התיאור של החישוב של הסתברות המעבר מ-{% equation %}i{% endequation %} אל {% equation %}j{% endequation %} ב-{% equation %}k{% endequation %} צעדים. זו דוגמה נאה לכך שבמתמטיקה ההגדרה הנכונה חשובה לעתים לא פחות מאשר המשפט הנכון - ברגע שרואים משהו מזווית הראייה הנכונה, הכל פתאום פשוט וכל החתיכות נופלות למקום. בדרך כלל אותה זווית ראייה היא משהו שכדי לשלוט בו נדרש קצת מאמץ (לאף אחד מאיתנו כפל מטריצות לא בא בקלות...) ולכן ה<strong>הפשטה</strong> שיש כאן כל כך מועילה - מרגע שהבנו כפל מטריצות, אנחנו מסוגלים באמצעותו להבין המוני בעיות שונות ומשונות שאת כולן ניתן לתרגם לכפל מטריצות, ובכך לחסוך את המאמץ שהיה נדרש מאיתנו להבין כל אחת לחוד.

בואו נניח שאנחנו רוצים לשאול שאלה קצת יותר כללית: "אחרי {% equation %}k{% endequation %} צעדים בשרשרת המרקוב, מה התפלגות המצבים שבהם נהיה?". למה הכוונה בכך? התשובה הצפויה היא משהו בסגנון "בהסתברות חצי נהיה במצב מס' 1, בהסתברות שליש במצב 2, ובהסתברות שישית במצב 3". את זה אפשר לתאר על ידי וקטור עם {% equation %}n{% endequation %} כניסות, {% equation %}v{% endequation %}, כך ש-{% equation %}v_{i}{% endequation %} הוא ההסתברות להיות במצב {% equation %}i{% endequation %}. וקטור כזה יכול לתאר גם את המצב ההתחלתי של השרשרת - אף אחד לא אמר שחייבים להתחיל ממצב אחד ספציפי; אפשר לבחור את המצב שבו מתחילים גם כן באופן מקרי. לכן {% equation %}v=\left(\frac{1}{3},\frac{1}{3},\frac{1}{3}\right){% endequation %} הוא וקטור שמתאר בחירה של כל מצב בהסתברות אחידה, ו-{% equation %}v=\left(0,1,0\right){% endequation %} הוא וקטור שמתאר התחלה ודאית במצב 2.

מה שצפוי כעת הוא שיתקיים שאם {% equation %}v{% endequation %} הוא ההתפלגות הנוכחית שלנו בנקודת זמן כלשהי, אז {% equation %}Pv{% endequation %} תהיה ההתפלגות אחרי צעד אחד. רק שזה לא עובד. כדי לראות זאת, בואו נניח ש-{% equation %}v=\left(1,0,0\right){% endequation %} - התחלה ודאית ממצב 1. נכפול ב-{% equation %}P{% endequation %} שלמעלה, ונקבל {% equation %}Pv=\left(1,\frac{1}{2},1\right){% endequation %}, שהוא בוודאי לא וקטור שמייצג הסתברות ולא כלום (יש כאן גם עניין לפיו {% equation %}v{% endequation %} הוצג כוקטור שורה ולא עמודה, אבל אני מניח שהפורמליזם הזה לא מפריע לכם). למעשה, אם תחשבו על זה לרגע, לא הייתה שום סיבה להניח שזה יעבוד; האפקט הרצוי מושג דווקא על ידי פעולת כפל מהצד השני, שהיא משהו שפחות ראינו עד היום אבל היא לגיטימית לגמרי לכשעצמה: {% equation %}vP=\left(\frac{1}{3},\frac{1}{3},\frac{1}{3}\right){% endequation %} - לא במפתיע, השורה הראשונה ב-{% equation %}P{% endequation %} - ולא קשה להוכיח שבאופן כללי כפל משמאל אכן מעביר את ההתפלגות {% equation %}v{% endequation %} להתפלגות הצפויה אחרי צעד אחד. וכמובן, {% equation %}vP^{k}{% endequation %} היא ההתפלגות שאליה מגיעים אחרי {% equation %}k{% endequation %} צעדים אם התחלנו ב-{% equation %}v{% endequation %}.
<h2><strong>ואיך אלגברה לינארית מתקשרת אליהן</strong></h2>
עכשיו בואו נעבור לאקשן. אגנוב דוגמה מהספר של Norris על שרשראות מרקוב פשוט כי היא כל כך מוצלחת. בואו נסתכל על השרשרת הפשוטה הבאה:

<strong><a href="{{site.baseurl}}{{site.post_images}}/2012/01/markov2.png"><img class="alignnone size-full wp-image-1486" title="markov2" alt="" src="{{site.baseurl}}{{site.post_images}}/2012/01/markov2.png" width="161" height="184" /></a>
</strong>

לצורך פשטות לא ציירתי את הקשתות מצומת לעצמו (אפשר להסיק מה הערכים שלהן). המטריצה של השרשרת הזו היא {% equation %}P=\left(\begin{array}{ccc}0 & 1 & 0\\0 & \frac{1}{2} & \frac{1}{2}\\\frac{1}{2} & 0 & \frac{1}{2}\end{array}\right){% endequation %}. כעת נותנים לנו תרגיל - למצוא נוסחה כללית עבור ההסתברות לפיה אם נתחיל מהמצב {% equation %}1{% endequation %}, אז כעבור {% equation %}n{% endequation %} צעדים גם כן נהיה במצב 1. בניסוח מטריציוני, שואלים אותנו מהי {% equation %}\left[P^{n}\right]_{11}{% endequation %}. זוהי שאלת אלגברה לינארית למהדרין, והדרך לפתרון שלה עוברת דרך ערכים עצמיים, אז בואו נתחיל מלמצוא את הערכים העצמיים לפי הספר. כאן יש לנו מזל - המטריצה קטנה, אז קל למצוא את הערכים העצמיים שלה, אבל לפעמים זה יכול להיות קשה למדי. הפולינום האופייני הוא

{% equation %}\left|\begin{array}{ccc}x & -1 & 0\\0 & x-\frac{1}{2} & -\frac{1}{2}\\-\frac{1}{2} & 0 & x-\frac{1}{2}\end{array}\right|=x\left|\begin{array}{cc}x-\frac{1}{2} & -\frac{1}{2}\\0 & x-\frac{1}{2}\end{array}\right|+\left|\begin{array}{cc}0 & -\frac{1}{2}\\-\frac{1}{2} & x-\frac{1}{2}\end{array}\right|{% endequation %}

{% equation %}=x\left(x-\frac{1}{2}\right)^{2}-\frac{1}{4}=x^{3}-x^{2}+\frac{1}{4}x-\frac{1}{4}=x^{2}\left(x-1\right)+\frac{1}{4}\left(x-1\right)=\left(x-1\right)\left(x^{2}+\frac{1}{4}\right){% endequation %}

אם כן, מייד רואים ש-{% equation %}1{% endequation %} הוא ערך עצמי, אבל פרט אליו אין ערכים עצמיים ממשיים: שני האחרים הם השורשים של {% equation %}x^{2}+\frac{1}{4}{% endequation %}, כלומר {% equation %}\pm\frac{i}{2}{% endequation %}. הנה צצים לנו מספרים מרוכבים בבעיה ממשית למהדרין, אבל אין כאן שום בעיה.

כעת, שימו לב שכל הערכים העצמיים הם שונים זה מזה, מה שמפשט לנו מאוד את החיים - מכיוון שהפולינום האופייני מתפרק לגורמים לינאריים שונים {% equation %}\left(x-1\right)\left(x-\frac{i}{2}\right)\left(x+\frac{i}{2}\right){% endequation %} נובע מייד ש-{% equation %}P{% endequation %} לכסינה, כלומר {% equation %}P=U^{-1}\left(\begin{array}{ccc}1 & 0 & 0\\0 & \frac{i}{2} & 0\\0 & 0 & -\frac{i}{2}\end{array}\right)U{% endequation %} עבור איזו {% equation %}U{% endequation %} הפיכה שלא מעניינת אותנו. מכאן נובע מייד ש-{% equation %}P^{n}=U^{-1}\left(\begin{array}{ccc}1 & 0 & 0\\0 & \left(\frac{i}{2}\right)^{n} & 0\\0 & 0 & \left(-\frac{i}{2}\right)^{n}\end{array}\right)U{% endequation %}.

כעת אפשר לחשב ישירות את {% equation %}\left[P^{n}\right]_{11}{% endequation %} על ידי חישוב {% equation %}U{% endequation %} וביצוע הכפל, אבל {% equation %}U{% endequation %} עשויה להיות מכוערת למדי ולא ברור עד כמה זה יוביל אותנו לנוסחה כללית טובה. במקום זאת ננקוט בתעלול אחר: מכיוון ש-{% equation %}P^{n}{% endequation %} מתקבלת על ידי כפל המטריצה האלכסונית מימין ב-{% equation %}U{% endequation %} ומשמאל ב-{% equation %}U^{-1}{% endequation %}, הרי ש-{% equation %}\left[P^{n}\right]_{11}{% endequation %} תהיה צירוף לינארי של הכניסות השונות מאפס של המטריצה האלכסונית (כי זה מה שכפל מטריצות עושה - צירופים לינאריים). לכן {% equation %}\left[P^{n}\right]_{11}=\alpha\cdot1+\beta\cdot\left(\frac{i}{2}\right)^{n}+\gamma\left(-\frac{i}{2}\right)^{n}{% endequation %}. כל שנותר לעשות הוא למצוא את המקדמים {% equation %}\alpha,\beta,\gamma{% endequation %} המתאימים. את זה עושים על ידי חישוב קונקרטי של {% equation %}\left[P^{0}\right]_{11},\left[P^{1}\right]_{11},\left[P^{2}\right]_{11}{% endequation %} והצבה בנוסחה (שאמורה לעבוד לכל {% equation %}n{% endequation %}). קל לראות שהערכים המתאימים הם 1,0,0, כך שקיבלנו את המשוואות:

{% equation %}\alpha+\beta+\gamma=1{% endequation %}

{% equation %}\alpha+\left(\frac{i}{2}\right)\left(\beta-\gamma\right)=0{% endequation %}

{% equation %}\alpha-\frac{1}{4}\left(\beta+\gamma\right)=0{% endequation %}

הפתרון למערכת הזו הוא {% equation %}\alpha=\frac{1}{5},\beta=\frac{2}{5}+\frac{1}{5}i,\gamma=\frac{2}{5}-\frac{1}{5}i{% endequation %}. שימו לב בפרט ש-{% equation %}\gamma=\overline{\beta}{% endequation %} (צמוד מרוכב) וזכרו ש-{% equation %}-i=\overline{i}{% endequation %}, כך שקיבלנו את הפתרון הכללי:

{% equation %}\left[P^{n}\right]_{11}=\frac{1}{5}+\left(\frac{1}{2}\right)^{n}\left[\beta i^{n}+\overline{\beta i^{n}}\right]=\frac{1}{5}+\left(\frac{1}{2}\right)^{n}\left(2\text{Re}\left(\beta i^{n}\right)\right){% endequation %}

ב-{% equation %}i^{n}{% endequation %} הכי קל לטפל בהצגה קוטבית שלא מצריכה חלוקה למקרים: {% equation %}i^{n}=e^{i\frac{\pi}{2}n}{% endequation %}, ולכן {% equation %}\beta i^{n}=\frac{2}{5}e^{i\frac{\pi}{2}n}+\frac{1}{5}ie^{i\frac{\pi}{2}n}{% endequation %}, ואם זוכרים ש-{% equation %}e^{i\theta}=\cos\theta+i\sin\theta{% endequation %} מקבלים חיש קל ש-{% equation %}2\text{Re}\left(\beta i^{n}\right)=\frac{4}{5}\cos\frac{n\pi}{2}-\frac{2}{5}\sin\frac{n\pi}{2}{% endequation %}, ולכן הפתרון לשאלה הוא:

{% equation %}\left[P^{n}\right]_{11}=\frac{1}{5}+\left(\frac{1}{2}\right)^{n}\left(\frac{4}{5}\cos\frac{n\pi}{2}-\frac{2}{5}\sin\frac{n\pi}{2}\right){% endequation %}

השתמשתי כאן בתעלול או שניים כדי לפשט את הפתרון, אבל לא יותר מדי - זו גם שיטת העבודה הכללית. בהערת אגב, אפשר היה לפשט עוד את הפתרון על ידי ביצוע משהו שאולי היה נראה לחלקכם כמו רמאות: כשקיבלתי את נוסחת הנסיגה {% equation %}\alpha\cdot1+\beta\cdot\left(\frac{i}{2}\right)^{n}+\gamma\left(-\frac{i}{2}\right)^{n}{% endequation %} להגיד "בגלל שאנחנו יודעים שהפתרון הוא ממשי, אז אפשר להחליף את הנוסחה הזו בנוסחת הנסיגה {% equation %}\alpha+\left(\frac{1}{2}\right)^{n}\left(\beta\cos\frac{n\pi}{2}+\gamma\sin\frac{n\pi}{2}\right){% endequation %}", אבל כמו שאנחנו רואים זה לא משפיע על התוצאה.

טוב, אז מה ראינו כאן? גם אם לא נכנסתם לעובי הפרטים הטכניים, לב העניין כאן היה שהתנהגות המערכת לטווח ארוך - ההסתברות לעבור ממצב {% equation %}i{% endequation %} למצב {% equation %}j{% endequation %} אחרי {% equation %}n{% endequation %} צעדים עבור {% equation %}n{% endequation %} כללי - ניתנה באמצעות צירוף לינארי של חזקות של הערכים העצמיים של המטריצה שמתארת את המערכת. זו המחשה נאה ביותר לאופן שבו הערכים העצמיים של המערכת מתארים אותה, והם בעצם אבן היסוד שמרגע שמגלים אותה, שאר התנהגות המערכת נובעת מאליה. למי שתוהה למה ערכים עצמיים הם מושג כה חשוב ומרכזי - זו התחלה.

בדוגמה שלמעלה היה לנו מזל - המטריצה הייתה <strong>לכסינה</strong>. באופן כללי זה לא כך, ואז התנהגות המערכת שנובעת מהערכים העצמיים מסובכת יותר אבל עדיין ניתנת לתיאור שיטתי באמצעות <strong>צורת ז'ורדן</strong> של מטריצות, שאני מקווה להציג מתישהו. נעזוב את זה לבינתיים.

בואו ננסה עכשיו להבין קצת יותר טוב מה הנוסחה ל-{% equation %}\left[P^{n}\right]_{11}{% endequation %} אומרת: שאחרי {% equation %}n{% endequation %} צעדים, אם התחלנו מהמצב 1, ההסתברות שלנו להיות ב-1 היא חמישית ועוד איזה "גורם כאוטי" שמתואר באמצעות {% equation %}\frac{4}{5}\cos\frac{n\pi}{2}-\frac{2}{5}\sin\frac{n\pi}{2}{% endequation %} (הסינוסים והקוסינוסים מעידים על כך שהגורם הזה הוא <strong>מחזורי</strong>, דבר לא מפתיע בפני עצמו) אבל כזה שההשפעה שלו דועכת אקספוננציאלית עם הזמן, מה שבא לידי ביטוי בכפל ב-{% equation %}\left(\frac{1}{2}\right)^{n}{% endequation %}. פורמלית, בבירור {% equation %}\lim_{n\to\infty}\left[P^{n}\right]_{11}=\frac{1}{5}{% endequation %}, מה שאומר שאנחנו מצפים, אם ניתן למערכת לרוץ זמן ארוך אחרי שהתחילה ממצב 1, להגיע לכך שבכל פרק זמן ההסתברות שהמערכת תהיה במצב 1 היא {% equation %}\frac{1}{5}{% endequation %}, ולכן שבריצה לטווח ארוך המערכת תהיה במצב 1 חמישית מהזמן. עכשיו אני רוצה לדבר על האופן שבו מבצעים ניתוח של "התנהגות לטווח ארוך" שכזו.

לב העניין הוא במה שמכונה "התפלגות אינוריאנטית" (או "שיווי משקל", או אולי "התפלגות סטציונרית"). בואו נתחיל מלשים לב לכך שהעובדה ש-1 היה ערך עצמי של {% equation %}P{% endequation %} בדוגמה למעלה לא הייתה מקרית. באופן כללי, אם כל השורות של מטריצה מסתכמות לאותו מספר {% equation %}a{% endequation %} (או כל העמודות מסתכמות לאותו מספר {% equation %}a{% endequation %}) אז {% equation %}a{% endequation %} הוא ערך עצמי של המטריצה. דרך אחת לראות זאת היא כך: אם כל השורות של המטריצה {% equation %}A{% endequation %} מסתכמות ל-{% equation %}a{% endequation %} אז {% equation %}v=\left(1,1,\dots,1\right){% endequation %} הוא וקטור עצמי של המטריצה כי {% equation %}Av=\left(a,a,\dots,a\right)=av{% endequation %} (כי כפל ב-{% equation %}v{% endequation %} פשוט סוכם את כל השורות של {% equation %}A{% endequation %} אחת אחת). אם כל העמודות של {% equation %}A{% endequation %} מסתכמות ל-{% equation %}a{% endequation %} אז מתקיים {% equation %}vA=\left(a,a,\dots,a\right){% endequation %} אבל לא הגדרנו ערכים עצמיים באמצעות פעולת הכפל משמאל. מצד שני, זה לא משנה כי מתקיים ש-{% equation %}vA=\left(Av\right)^{t}=A^{t}v{% endequation %}, כאשר {% equation %}t{% endequation %} מציין את אופרטור השחלוף: {% equation %}\left[A_{ij}^{t}\right]=A_{ji}{% endequation %} (שיקוף הכניסות של {% equation %}A{% endequation %} ביחס לאלכסון הראשי). לא קשה להוכיח של-{% equation %}A{% endequation %} ול-{% equation %}A^{t}{% endequation %} אותו פולינום אופייני (הפיתוח של הדטרמיננטה יהיה זהה פרט לכך שכאשר מפתחים אחת מהן על פי שורה, את השניה מפתחים על פי עמודה) ולכן אותם ערכים עצמיים.

במקרה שלנו שורות {% equation %}P{% endequation %} מסתכמות ל-1, ולכן תמיד יתקיים ש-{% equation %}P\cdot\left(1,\dots,1\right)=\left(1,\dots,1\right){% endequation %} ולכן 1 הוא ערך עצמי של {% equation %}P{% endequation %}. מה שזה אומר הוא שקיים וקטור {% equation %}v{% endequation %} שמקיים {% equation %}vP=v{% endequation %} גם בכפל <strong>משמאל</strong>; הוקטור הזה כלל לא צריך להיות דומה ל-{% equation %}\left(1,\dots,1\right){% endequation %}. בואו נגלה אותו עבור {% equation %}P{% endequation %} של הדוגמה שלנו; אנחנו רוצים לפתור את מערכת המשוואות {% equation %}\left(\begin{array}{ccc}-1 & 0 & \frac{1}{2}\\1 & -\frac{1}{2} & 0\\0 & \frac{1}{2} & -\frac{1}{2}\end{array}\right)v=0{% endequation %} (שחלפתי את {% equation %}P{% endequation %} והפחתתי 1 מהאלכסון הראשי). קצת דירוג מטריצות ונקבל {% equation %}\left(\begin{array}{ccc}1 & 0 & -\frac{1}{2}\\0 & 1 & -1\\0 & 0 & 0\end{array}\right)v=0{% endequation %}, כלומר הצורה הכללית של הפתרון {% equation %}v{% endequation %} היא {% equation %}v=\left(\frac{1}{2}\alpha,\alpha,\alpha\right){% endequation %} עבור פרמטר {% equation %}\alpha{% endequation %} כלשהו.

מבין כל הוקטורים העצמיים {% equation %}v{% endequation %} האפשריים, יש אחד שמעניין אותנו במיוחד: כזה שמייצג <strong>התפלגות מצבים</strong>. כדי שוקטור יקיים את התכונה הזו, הוא צריך להיות <strong>אי שלילי</strong> (כלומר, שכל כניסה בו תהיה גדוהל או שווה מ-0, כי אין אצלנו משמעות להסתברות שלילית), והוא צריך שהכניסות שלו יסתכמו ל-1 (בפועל אפשר לקחת כל וקטור אי שלילי ופשוט לחלק את כל הכניסות שלו בסכום הכניסות). במקרה שלנו מתקבל וקטור התפלגות שכזה עבור {% equation %}\alpha=\frac{2}{5}{% endequation %}: נקבל {% equation %}u=\left(\frac{1}{5},\frac{2}{5},\frac{2}{5}\right){% endequation %}. ה-{% equation %}\frac{1}{5}{% endequation %} בכניסה הראשונה היא לא מקרית, כפי שאסביר בקרוב.

בואו נבין מה מצאנו כרגע: מצאנו וקטור התפלגויות {% equation %}u{% endequation %} כך ש-{% equation %}uP=u{% endequation %}. כלומר, זוהי התפלגות מצבים שאם השרשרת שלנו הגיעה אליה, היא תישאר בה לעד. כמובן, בכל צעד בשרשרת אנחנו עדיין עוברים ממצב למצב באופן הסתברותי, אבל ההתפלגות הכוללת של כל המצבים שבהם אנו עשויים להיות נותרת ללא שינוי. זה מסביר את התארים של "התפלגות אינוריאנטית/סטציונרית" ו"שיווי משקל".

התוצאה המעניינת הראשונה על התפלגויות אינוריאנטיות מסבירה את ה-{% equation %}\frac{1}{5}{% endequation %} שקיבלנו ב-{% equation %}u{% endequation %}. אם יש לנו שרשרת מרקוב סופית (הסופיות קריטית פה) כך שעבור מצב {% equation %}i{% endequation %} כלשהו מתקיים ש-{% equation %}\lim_{n\to\infty}\left[P_{ij}^{n}\right]=\pi_{j}{% endequation %} לכל מצב {% equation %}j{% endequation %} (אנו דורשים רק שהגבול יהיה קיים; {% equation %}\pi_{j}{% endequation %} הוא איך אנחנו מסמנים אותו אם הוא קיים) אז הוקטור {% equation %}\left(\pi_{1},\pi_{2},\dots,\pi_{k}\right){% endequation %} הוא וקטור התפלגות אינוריאנטית. במקרה של {% equation %}P{% endequation %} שלנו אכן מתקיים {% equation %}\lim_{n\to\infty}\left[P_{12}^{n}\right]=\lim_{n\to\infty}\left[P_{13}^{n}\right]=\frac{2}{5}{% endequation %} אבל לא טרחתי לחשב את הנוסחה שלהם כדי לראות זאת.

אם כן, ההתפלגות האינוריאנטית מתארת את ההתנהגות לטווח ארוך של {% equation %}P{% endequation %} אם קיימת כזו - {% equation %}P{% endequation %} "שואפת" להתפלגות האינוריאנטית. השאלה המהותית יותר היא <strong>מתי</strong> התכנסות כזו אכן מובטחת. בואו נראה דוגמה פשוטה ביותר שבה אין התכנסות - שרשרת שבה יש שני מצבים, כך שמכל אחד עוברים לשני בהסתברות אחת. לשרשרת הזו יש את המטריצה {% equation %}P=\left(\begin{array}{cc}0 & 1\\1 & 0\end{array}\right){% endequation %}. בבירור 1 הוא ערך עצמי של {% equation %}P{% endequation %}. מרחב הוקטורים העצמיים השייכים לערך העצמי 1 נפרש על ידי {% equation %}\left(\alpha,\alpha\right){% endequation %} ולכן {% equation %}\left(\frac{1}{2},\frac{1}{2}\right){% endequation %} היא התפלגות אינוריאנטית (חשבו על זה קצת - זה פשוט למדי אחרי שמבינים מה הולך כאן). אלא ש-{% equation %}P{% endequation %} לא מתכנסת לשום מקום; שימו לב ש-{% equation %}P^{2}=\left(\begin{array}{cc}1 & 0\\0 & 1\end{array}\right){% endequation %} ולכן {% equation %}P^{3}=P{% endequation %}, ובאופן כללי כל כניסה של {% equation %}P{% endequation %} "מזגזגת" בין 0 ו-1 ולכן לא מתכנסת. הבעיה כאן היא בכך שהשרשרת שלנו היא <strong>מחזורית</strong>. אין צורך להסתבך עם הגדרות בעייתיות פה כדי לתאר מחזוריות של תהליך אקראי: די לנו להגדיר ששרשרת היא <strong>לא מחזורית</strong> אם {% equation %}\left[P^{n}\right]_{ii}&gt;0{% endequation %} עבור {% equation %}n{% endequation %} גדול דיו לכל {% equation %}i{% endequation %} (אפשר לראות שהגדרה זו שקולה לדרישה שהמחלק המשותף הגדול ביותר של קבוצת ה-{% equation %}n{% endequation %}-ים שעבורם {% equation %}\left[P^{n}\right]_{ii}&gt;0{% endequation %} עבור {% equation %}i{% endequation %} מסויים הוא 1).

אפשר היה אולי לחשוב שמספיק לדרוש שמצב אחד בלבד יהיה לא מחזורי, ואז אי-המחזוריות שלו "תפעפע" לשאר המחרוזת. זה גם נכון, בתנאי שלא ניתן לפרק את המחרוזת ל"רכיבי קשירות" שלא מתקשרים זה עם זה. מבלי להיכנס יותר מדי להגדרות הפורמליות, שרשרת מרקוב היא <strong>בלתי פריקה</strong> אם לכל מצב {% equation %}i{% endequation %} ולכל מצב {% equation %}j{% endequation %}, אם התחלנו מ-{% equation %}i{% endequation %} יש לנו סיכוי להגיע מתישהו ל-{% equation %}j{% endequation %} (קצת יותר פורמלית, {% equation %}\left[P^{n}\right]_{ij}&gt;0{% endequation %} עבור {% equation %}n{% endequation %} גדול דיו). אפשר להראות ששרשרת מרקוב שיש בה מצב אחד בלבד שהוא אי מחזורי והיא אי פריקה תהיה אי מחזורית בכל המצבים שלה.

כעת אפשר לנסח את מה שהוא כנראה המשפט החשוב ביותר בכל הפוסט: אם נתונה לנו שרשרת מרקוב אי מחזוריות ובלתי פריקה (לא בהכרח סופית!) וקיימת לה התפלגות אינוריאנטית {% equation %}\pi=\left(\pi_{1},\dots,\pi_{k}\right){% endequation %}, אז בלתי תלות בשאלה מה ההתפלגות שבה מתחילים את ריצת השרשרת, לכל מצב {% equation %}j{% endequation %} ההסתברות שהשרשרת תהיה ב-{% equation %}j{% endequation %} בצעד ה-{% equation %}n{% endequation %} שואפת ל-{% equation %}\pi_{j}{% endequation %} כאשר {% equation %}n{% endequation %} שואף לאינסוף ({% equation %}\lim_{n\to\infty}\text{P}\left(X_{n}=j\right)=\pi_{j}{% endequation %} כאשר {% equation %}X_{n}{% endequation %} הוא המשתנה המקרי שמתאים ל"המצב של השרשרת בזמן {% equation %}n{% endequation %}"). בפרט זה אומר ש-{% equation %}\lim_{n\to\infty}\left[P^{n}\right]_{ij}=\pi_{j}{% endequation %} לכל {% equation %}i,j{% endequation %}. פירוש הדבר הוא שבשרשראות אי מחזוריות ובלתי פריקות, ההתפלגות האינוריאנטית של השרשרת מתארת בדיוק את ההתנהגות לטווח ארוך שלה. ההוכחה של המשפט היא מקסימה גם היא אבל אינה פשוטה ולא אציג אותה כעת.
<h2><strong>ואיך כל זה קשור לגוגל</strong></h2>
לסיום הפוסט אני רוצה להסביר איך כל זה קשור לגוגל. בשנת 1998 פרסמו סרגיי ברין ולארי פייג', מייסדי גוגל, מאמר (שהיה תוצאה של פרוייקט שעשו באוניברסיטת סטנפורד) שהציע שיטת דירוג עמודי אינטרנט שנקראה PageRank (על שם לארי פייג', לא בגלל ש-Page הוא דף). כמובן, גוגל הוא הרבה יותר מאשר רק השיטה הזו, ומנוע החיפוש האמיתי של גוגל משתמש באינספור הרחבות, וריאציות ותיקונים על השיטה הזו, אבל הרעיון הבסיסי בשיטה הוא חזק לכשעצמו ואציג רק אותו.

אנחנו רוצים לדרג דפים לפי ה"חשיבות" שלהם, אבל איך קובעים מתי דף הוא חשוב? ברין ופייג' הציעו את ההגדרה המטופשת "דף חשוב הוא דף שהרבה דפים חשובים מקשרים אליו". מטופשת, כי היא נראית מעגלית וחסרת טעם. אלא שהיא בכלל לא מטופשת.

פורמלית, אצל ברין ופייג' ה-PageRank של דף הוא סכום על ה-PageRank של הדפים שמקשרים, כאשר לכל דף שמקשר אליו אותו PageRank מחולק במספר הדפים שאליהם אותו דף מקשר. בנוסף לכך יש איזה פרמטר {% equation %}d{% endequation %} שתכף אסביר את חשיבותו. הנוסחה של ברין ופייג' היא

{% equation %}\text{PR}\left(A\right)=\frac{1-d}{N}+d\sum_{T_{i}}\frac{\text{PR}\left(T_{i}\right)}{C\left(T_{i}\right)}{% endequation %}

כאשר {% equation %}N{% endequation %} הוא מספר הדפים הכולל באינטרנט (ליתר דיוק - באוסף הדפים שעבורם מחשבים את PageRank) הסכום רץ על כל הדפים {% equation %}T_{i}{% endequation %} שמקשרים ל-{% equation %}A{% endequation %}, ו-{% equation %}C\left(T_{i}\right){% endequation %} הוא מספר הלינקים הכולל שיוצא מ-{% equation %}T_{i}{% endequation %}. הגדרה מעגלית, אבל בכלל לא בעייתית. הנקודה היא שזה בדיוק מה שמקבלים אם ממדלים גלישה באינטרנט בתור שרשרת מרקוב.

הרעיון הוא לחשוב על האינטרנט בתור גרף אחד גדול, שבו כל דף הוא צומת, ויש קשת מדף א' לדף ב' אם דף א' מקשר אל דף ב'. כעת אנחנו חושבים על שרשרת מרקוב שבה המשתמש מטייל בגרף. בכל פעם שבה הוא בצומת מסויים, הוא בוחר את הצומת הבא לעבור אליו בהסתברות שווה מבין כל הצמתים שניתן להגיע אליהם מהצומת הנוכחי. כמו כן, בהסתברות {% equation %}1-d{% endequation %} (אצל ברין ופייג' {% equation %}d{% endequation %} נקבע ל-{% equation %}0.85{% endequation %} בתחילה) המשתמש "ישתעמם" ופשוט יעבור לדף אחר באינטרנט (כולו!) באופן אקראי. אני משאיר לכם לחשוב איך אפשר לתאר את כל זה פורמלית בתור שרשרת מרקוב - זה לא קשה.

אין ספק שיש לנו כאן תיאור נאיבי ביותר של האופן שבו אנשים גולשים באינטרנט, אבל אפשר לשפר אותו אם יש בכך צורך (למשל, שלא כל הלינקים בתוך עמוד יקבלו משקל זהה), וגם בגרסתו הבסיסית התיאור הזה נותן תוצאות מועילות למדי. כעת, שימו לב ששרשרת המרקוב הזו היא אי מחזורית (כי תמיד יש סיכוי שתחזור לדף שהתחלת ממנו - אפילו אחרי צעד אחד אם אתה "משתעמם") ואי פריקה (שוב, ה"שיעמום" מבטיח שתוכל להגיע לכל דף מכל דף אחר בהסתברות נמוכה כלשהי). לכן היא מתכנסת להתפלגות אינוריאנטית - ומה זו ההתפלגות האינוריאנטית הזו? ניחשתם נכון, קל לראות ש-{% equation %}\text{PR}\left(A\right){% endequation %} היא בדיוק התפלגות אינוריאנטית של השרשרת הזו. המעגליות של ההגדרה נפתרה: זו בדיוק אותה מעגליות שיש בהגדרה בסגנון "{% equation %}Av=v{% endequation %}" - אם {% equation %}A{% endequation %} נתונה, כמובן שזו לא הגדרה מעגלית של {% equation %}v{% endequation %} כלל.

בקיצור, {% equation %}\text{PR}\left(A\right){% endequation %} מתאים בדיוק להתנהגות לטווח ארוך של גולש אקראי במודל הגלישה שהצענו. מבחינה אינטואיטיבית המודל הזה קורץ למדי. עם זאת, עוד לא הבהרנו שתי נקודות חשובות: ראשית, למה בכלל <strong>קיים</strong> וקטור עצמי של 1 שהוא אי-שלילי? כל עוד לא הוכחנו קיום של כזה, לא הוכחנו שיש בכלל פתרון למערכת המשוואות שמגדירה את {% equation %}\text{PR}{% endequation %}. שנית, איך מוצאים את הוקטור הזה בפועל? אנחנו מדברים כאן על מטריצות ענקיות (ברין ופייג' דיברו במאמר על מטריצות מסדר 26 מיליון על 26 מיליון; בפועל כמובן שגוגל מתעסקים עם דברים גדולים יותר).

אלו שאלות טובות והתחום של מציאת ערכים עצמיים למטריצות גדולות הוא חשוב ומעניין ומסובך בפני עצמו ואיני יכול להיכנס אליו יותר מדי כרגע, אבל אני יכול לומר משהו בקיצור: המשפט שמהווה את עמוד השדרה לשיטה של ברין ופייג' נקרא <strong>משפט פרון-פרובניוס</strong> והוא אחד מעמודי התווך של האלגברה הלינארית. לא אוכל להציג את המשפט בשלמותו (הוא אומר הרבה דברים), אבל אספר את מה שרלוונטי לנו כרגע.

בהינתן מטריצה {% equation %}A{% endequation %} מעל {% equation %}\mathbb{R}{% endequation %} או {% equation %}\mathbb{C}{% endequation %}, <strong>הרדיוס הספקטרלי</strong> שלה {% equation %}\rho\left(A\right){% endequation %} הוא הערך המוחלט המקסימלי של הערכים העצמיים של {% equation %}A{% endequation %} - אם תרצו, חשבו על זה בתור רדיוס העיגול הקטן ביותר ב-{% equation %}\mathbb{C}{% endequation %} שמרכזו בראשית הצירים ומכיל בתוכו את כל הערכים העצמיים של {% equation %}A{% endequation %} (שהם בסופו של דבר איברים של {% equation %}\mathbb{C}{% endequation %}). שימו לב כי {% equation %}\rho\left(A\right){% endequation %} הוא תמיד מספר ממשי. כעת, החלק הרלוונטי עבורנו ממשפט פרון-פרובניוס אומר כי אם {% equation %}A{% endequation %} היא מטריצה חיובית (שכל כניסותיה הן מספרים ממשיים גדולים מאפס, כמו במקרה של {% equation %}P{% endequation %} של ברין ופייג') כך ש-{% equation %}r=\rho\left(A\right){% endequation %}, אז {% equation %}r{% endequation %} הוא ערך עצמי של {% equation %}A{% endequation %} (זה בפני עצמו לא טריוויאלי; אם {% equation %}r=\rho\left(A\right){% endequation %} כל מה שאפשר לעשות באופן כללי הוא לומר שקיים ערך עצמי {% equation %}\lambda{% endequation %} - שיכול להיות שלילי או מרוכב - כך ש-{% equation %}r=\left|\lambda\right|{% endequation %}), וכל ערך עצמי אחר של {% equation %}A{% endequation %} הוא קטן ממש בערכו המוחלט מ-{% equation %}r{% endequation %}, וקיים וקטור עצמי של {% equation %}r{% endequation %} (הן מימין והן משמאל) שכל הכניסות שלו חיוביות.

כעת, מה הרדיוס הספקטרלי של מטריצה סטוכסטית כמו אלו שבהן התעסקנו בפוסט הזה? ברור שהוא לפחות 1 כי 1 הוא וקטור עצמי. ממשפט פרון-פרובניוס עולה כי אם 1 הוא לא הרדיוס הספקטרלי אז קיים {% equation %}\lambda>1{% endequation %} ממשי שגם הוא ערך עצמי, עם וקטור עצמי {% equation %}v{% endequation %} שכל כניסותיו הן ממשיות חיוביות, כלומר {% equation %}Av=\lambda v{% endequation %}. קל מאוד לראות שזה בלתי אפשרי: נניח ש-{% equation %}v_{max}{% endequation %} הוא ערכה של הכניסה הגדולה ביותר ב-{% equation %}v{% endequation %}, אז מכיוון שכל שורה של {% equation %}A{% endequation %} מסתכמת ל-1, רואים מייד שכל כניסה ב-{% equation %}Av{% endequation %} היא לכל היותר {% equation %}v_{max}{% endequation %}, אבל ב-{% equation %}\lambda v{% endequation %} יש כניסה שהיא גדולה ממש מ-{% equation %}v_{max}{% endequation %}. לכן במקרה שלנו הרדיוס הספקטרלי הוא בדיוק 1, ולכן קיים למטריצה וקטור עצמי אי-שלילי עבור הערך העצמי 1, ולכן קיימת התפלגות אינוריאנטית, בדיוק כפי שרצינו (יש עוד דרכים להוכיח את עניין הרדיוס הספקטרלי בלי תותח כבד כמו פרון-פרובניוס, אבל לצרכים שלנו כאן זה הכי התאים).

אם כן, ראינו שהתורה של שרשראות מרקוב (עם מרחב מצבים סופי) קשורה בקשר בל-ינתק לאלגברה לינארית; ראינו איך ערכים עצמיים הם השחקן המרכזי בניתוחים שנובעים מכך; ראינו בחטף משפט מרכזי שעוסק בערכים עצמיים של מטריצות חיוביות - פרון-פרובניוס - ואת האופן שבו הוא, יחד עם התורה של שרשראות מרקוב, משמשים באפליקציות מציאותיות ביותר. זה היה רק קצה הקרחון של השימושים של הנושאים שהזכרתי בפוסט הזה, אבל לטעמי קצה הקרחון הזה לכעצמו מספיק כדי להטביע את הטיטאניק.

